{% set container = fetch_container_instance() %}
{% set userRepository = fetch_repository('FaUserBundle:User') %}
{% set paymentRepository = fetch_repository('FaPaymentBundle:Payment') %}
{% set orderDetailValuesArray = array_unserialize(orderDetail['value']) %}
{% set profileName = userRepository.getFullNameFromArray(orderDetail) %}
{% set buyerRole = userRepository.getUserRole(orderDetail['user_id']) %}
{% set sellerRole = userRepository.getUserRole(orderDetail['seller_id']) %}
{% set buyerLogo = staticCall('Fa\\Bundle\\CoreBundle\\Manager\\CommonManager', 'getUserLogoByUserId', [fetch_container_instance(), orderDetail['user_id'], null]) %}
{% set sellerLogo = staticCall('Fa\\Bundle\\CoreBundle\\Manager\\CommonManager', 'getUserLogoByUserId', [fetch_container_instance(), orderDetail['seller_id'], null]) %}
<!doctype html>
<html class="no-js" lang="en">
<head>
    <script src="{{ asset_url('fafrontend/js/vendor/jquery.js') }}"></script>
    <meta charset="utf-8" />
    <title>Receipt</title>
    <link rel="stylesheet" type="text/css" href="{{ static_asset_url('/bundles/fafrontend/css/google-fonts.css') }}" />
    <style>
        body{font-family: 'Asap', sans-serif;font-size:15px;line-height:24px}
        .lsize{width:520px}
        .clearfix:after{content:"";display:block;height:0;clear:both;visibility:hidden}
        .receipt-item{border-top:2px dotted #313133;padding:17px 3px}
        .receipt-item .col-1{width:257px;float:left;font-size:14px}
        .receipt-item .col-2{width:207px;float:left;padding-left:50px;font-size:14px}
        .receipt-item .col-2 p{margin:5px 0}
        .receipt-item .col-1.order-no, .receipt-item .col-2.order-no{font-size:16px}
        .receipt-item .col-1.order-no b, .receipt-item .col-2.order-no b{margin-right:8px}
        .shipping-address{font-size:13px;line-height:normal;font-style:italic}
        .user-pro-pic{width:70px;height:58px;background:#fff;overflow:hidden;text-align:center;float:left;margin:3px 10px 0 0;position:relative}
        .user-pro-pic img{max-width:78px;vertical-align:middle}
        .profile-placeholder{background:#a8a8a8;width:70px;height:58px;line-height:54px}
        .user-name{float:left;margin:21px 0 0}
        .inactive-profile{width:100%;height:100%;position:absolute;left:0;top:0;font-size:20px;font-weight:700;color:#fff;background-color:rgba(155, 155, 155,0.8);filter:alpha(opacity=80);}
        .user-pro-pic.rounded{width:60px;height:60px;border-radius:50%;}
        .user-pro-pic.rounded img{border-radius:50%;max-width:60px;max-height:60px;}
        .user-pro-pic.rounded span{width:60px;height:60px;border-radius:50%;background-size:cover;background-repeat:no-repeat;background-position:center center;display:inline-block;}
        .user-pro-pic .inactive-profile{font-size:13px;line-height:60px}
        .user-pro-pic.rounded .inactive-profile{border-radius:50%}
    </style>
</head>
<body>
    <div class="lsize">
        <img  class="img-fluid" style="margin: 20px 0 0 0" src="{{ shared_url('/bundles/fafrontend/images/fad-logo.svg') }}">
        <div class="receipt-item clearfix">
            <div class="col-1 order-no"><b>Order no.</b> {{ orderDetail['cart_code'] }}</div>
            <div class="col-2 order-no"><b>Order placed</b> {{ staticCall('Fa\\Bundle\\CoreBundle\\Manager\\CommonManager', 'formatDate', [orderDetail['created_at'], container]) }}</div>
        </div>
        <div class="receipt-item clearfix">
            <div class="col-1">
                <b>Payment method</b> <br />
                Paid via {{ paymentRepository.getPaymentMethodNameById(constant('Fa\\Bundle\\PaymentBundle\\Repository\\PaymentRepository::PAYMENT_METHOD_PAYPAL_ID'), container) }} <br />
                Paid on {{ staticCall('Fa\\Bundle\\CoreBundle\\Manager\\CommonManager', 'formatDate', [orderDetail['created_at'], container]) }}
            </div>
            <div class="col-2">
                <b>Shipping</b>
                <p>Post to:</p>
                <div class="shipping-address">
                {% if orderDetail['delivery_method_id'] !=  constant('Fa\\Bundle\\PaymentBundle\\Repository\\DeliveryMethodOptionRepository::COLLECTION_ONLY_ID') and orderDetailValuesArray['delivery_address_id'] != -1 %}
                    {{ profileName }}<br />
                    {% set orderDeliveryAddressArray = orderDetailValuesArray['delivery_address_info'] %}
                        {% if orderDeliveryAddressArray['street_address'] is defined %}
                            {% if orderDeliveryAddressArray['street_address'] is defined %}
                                {{orderDeliveryAddressArray['street_address']}}&nbsp;
                            {% endif %}
                            {% if orderDeliveryAddressArray['street_address_2'] is defined %}
                                {{orderDeliveryAddressArray['street_address_2']}}, <br />
                            {% endif %}
                            {% if orderDeliveryAddressArray['town_name'] is defined %}
                                {{orderDeliveryAddressArray['town_name']}}, <br />
                            {% endif %}
                            {% if orderDeliveryAddressArray['domicile_name'] is defined %}
                                {{orderDeliveryAddressArray['domicile_name']}}, <br />
                            {% endif %}
                            {% if orderDeliveryAddressArray['zip'] is defined %}
                                {{orderDeliveryAddressArray['zip']}}
                            {% endif %}
                        {% endif %}
                {% else %}
                    {{'Buyer will collect the item.'|trans({}, 'frontend-my-orders')}}
                {% endif %}
                </div>
            </div>
        </div>
        <div class="receipt-item clearfix">
            <div class="col-1">
                <b>Seller</b>
                <div class="clearfix">
                    <div class="user-pro-pic {% if sellerRole == constant('Fa\\Bundle\\UserBundle\\Repository\\RoleRepository::ROLE_SELLER') %}rounded{% endif %}">
                        {{sellerLogo|raw}}
                    </div>
                    <div class="user-name">{{ orderDetail['sender_profile_name'] }}</div>
                </div>
            </div>
            <div class="col-2">
                <b>Buyer</b>
                <div class="clearfix">
                    <div class="user-pro-pic {% if buyerRole == constant('Fa\\Bundle\\UserBundle\\Repository\\RoleRepository::ROLE_SELLER') %}rounded{% endif %}">
                        {{buyerLogo|raw}}
                    </div>
                    <div class="user-name">{{ profileName }}</div>
                </div>
            </div>
        </div>
        <div class="receipt-item clearfix">
            <div><b>Order</b></div>
            <div class="col-1">
                {{ orderDetail['title'] }}<br />
                 {% set productPrice = orderDetail['amount'] %}
                {% if orderDetailValuesArray['postage_price'] is defined %}
                    {% set productPrice = orderDetail['amount'] - orderDetailValuesArray['postage_price'] %}
                    Postage cost<br />
                {% endif %}
                Total
            </div>
            <div class="col-2">
                {{ format_currency(productPrice) }}<br />
                {% if orderDetailValuesArray['postage_price'] is defined %}
                    {{ format_currency(orderDetailValuesArray['postage_price']) }}<br />
                {% endif %}
                <b>{{ format_currency(orderDetail['amount']) }}</b>
            </div>
        </div>
    </div>
</body>
</html>
<script language="javascript" type="text/javascript">
//<![CDATA[
$(window).load(function()
{
   var action = "{{action}}"

   if (action == "viewandprint") {
    window.print();
   }
});
//]]>
</script>