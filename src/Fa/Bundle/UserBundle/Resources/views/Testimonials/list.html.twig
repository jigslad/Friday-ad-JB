{% extends 'FaFrontendBundle::layout.html.twig' %}

{% block title %}
    {{'Testimonials'|trans({}, 'frontend-testimonials')}}
{% endblock %}

{% block canonical_url %}
    {{ app.request.uri|replace({('?'~app.request.queryString) : ''})}}
{% endblock %}

{% set container = fetch_container_instance() %}

{% block body -%}
    <style>
        .testimonial-list {
            list-style: none;
            margin: 0;
        }
        .testimonial-list li {
            font-size: 14px;
            line-height: 26px;
            font-style: italic;
            margin-bottom: 24px;
        }
        .testimonial-icon {
            display: inline-block;
            width: 21px;
            height: 19px;
            vertical-align: top;
            margin: 2px 5px 0 0;
            background: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20version%3D%221.1%22%20x%3D%220%22%20y%3D%220%22%20width%3D%2221%22%20height%3D%2219%22%20viewBox%3D%22-1407%20462.9%2021%2019%22%20xml%3Aspace%3D%22preserve%22%3E%3Cstyle%20type%3D%22text/css%22%3E%0D%0A%09.st0%7Bfill%3A%23E3E3E3%3B%7D%0D%0A%3C/style%3E%3Ctitle%3Etestimonial%20icon%3C/title%3E%3Cdesc%3ECreated%20with%20Sketch.%3C/desc%3E%3Cg%20transform%3D%22translate%28-186.000000%2C%20-370.000000%29%22%3E%3Cg%20transform%3D%22translate%28184.000000%2C%20370.000000%29%22%3E%3Cg%20transform%3D%22translate%282.000000%2C%200.000000%29%22%3E%3Cpath%20class%3D%22st0%22%20d%3D%22M-1403.4%20473c0%200.7%200.4%201%201.1%201l1.2%200.1c0.8%200%201.6%200.4%202.2%201.2%200.6%200.7%200.9%201.6%200.9%202.5%200%201.1-0.4%202.1-1.2%202.9%20-0.8%200.8-1.8%201.2-3%201.2%20-1.4%200-2.6-0.6-3.5-1.7%20-0.9-1.1-1.3-2.6-1.3-4.3%200-3.3%201.3-6.6%203.8-10.1%200.9-1.3%201.7-1.9%202.4-1.9%200.8%200%201.1%200.4%201.1%201.2%200%200.3-0.2%200.8-0.7%201.4%20-0.8%201-1.5%202.2-2.2%203.6S-1403.4%20472.3-1403.4%20473L-1403.4%20473zM-1391.8%20473c0%200.7%200.4%201%201.1%201l1.2%200.1c0.8%200%201.5%200.4%202.1%201.2%200.6%200.7%200.9%201.6%200.9%202.5%200%201.1-0.4%202.1-1.2%202.9%20-0.8%200.8-1.8%201.2-3%201.2%20-1.4%200-2.5-0.6-3.4-1.7s-1.3-2.6-1.3-4.3c0-3.3%201.3-6.6%203.8-10.1%200.9-1.3%201.7-1.9%202.4-1.9%200.8%200%201.1%200.4%201.1%201.2%200%200.3-0.2%200.8-0.7%201.4%20-1.1%201.4-2%203.1-2.7%205C-1391.7%20472-1391.8%20472.5-1391.8%20473L-1391.8%20473z%22/%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E') no-repeat;
        }
        .send-comment {
            background: #efefef url(/bundles/fafrontend/images/testimonial-graphic.svg) no-repeat center bottom;
            border: 1px solid #e3e3e3;
            border-radius: 2px;
            padding: 30px 20px 0;
            min-height: 428px;
        }
    </style>
    <div class="homepage-row testimonial-heading">
        <div class="container">
            <div class="row">
                <div class="col">
                    <h1 class="s-h1 text-center">{{'Testimonials'|trans({}, 'frontend-testimonials')}}</h1>
                    <h2 class="s-h2 text-center">{{'Here are the latest testimonials from people like you'|trans({}, 'frontend-testimonials')}}</h2>
                </div>
            </div>
        </div>
    </div>
    <div class="homepage-row testimonial-main white-bg">
        <div class="container">
            <div class="row" id="testimonials_list_id">
                <div class="col-md-17">
                    {% if pagination.getNbResults() %}
                        <ul class="testimonial-list">
                            {% for testimonial in pagination.getCurrentPageResults() %}
                                <li>
                                    <span class="testimonial-icon"></span>{{ testimonial['comment']|raw }}
                                    <h5>{% if testimonial['user_name'] %}{{testimonial['user_name']}}, {% endif%}{{ staticCall('Fa\\Bundle\\CoreBundle\\Manager\\CommonManager', 'formatDate', [testimonial['created_at'], container]) }}</h5>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        {{ 'No records found.'|trans({}, 'frontend-testimonials') }}
                    {% endif %}
                    <div class="pagination-centered">
                        {{ include('FaFrontendBundle:Default:googlePager.html.twig', {'pagination': pagination, 'addToEndPage': 0, 'seoPager': false}) }}
                    </div>
               </div>
               <div class="col-md-7">
                   <div class="send-comment">
                       <button class="secondary-btn-1 btn btn-block text-center mt20" onclick="return addTestimonial();">{{'Send us your comment'|trans({}, 'frontend-testimonials')}}</button>
                   </div>
               </div>
            </div>
        </div>
    </div>
    <div id="addTestimonialModal" class="modal custom-modal small"></div>
{% endblock %}

{% block scriptbottom %}
    {{ include('FaCoreBundle:Default:blockJs.html.twig') }}
    <script language="javascript" type="text/javascript">
    //<![CDATA[
    $(document).ready(function(){
        {% if app.user and app.request.cookies.has('add_testimonial_flag') and app.request.cookies.has('add_testimonial_flag') != constant('Fa\\Bundle\\CoreBundle\\Manager\\CommonManager::COOKIE_DELETED') and app.request.cookies.get('add_testimonial_flag') %}
            addTestimonial();
        {% endif %}
    });

    function addTestimonial()
    {
        blockPage();
        $.ajax({
            type: "GET",
            url : '{{ path('add_testimonial') }}',
            data : {'redirectUrl': '{{app.request.getUri()}}'},
        })
        .always(function(response) {
            unblockPage();
        })
        .done(function(response) {
            hideAlertMessage();
            if (response.htmlContent.length) {
                $('#addTestimonialModal').html(response.htmlContent);
                $('#addTestimonialModal').modal('show');
            } else if (response.error.length) {
                $('#testimonials_list_id').prepend(decorateMessage(response.error, 'alert'));
                scrollToElement('#testimonials_list_id', '1000', -150);
            } else if (response.redirectToUrl.length) {
                window.location.href = response.redirectToUrl;
            }
        });
    }
    //]]>
    </script>
{% endblock %}