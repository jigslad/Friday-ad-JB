<!-- Core Scripts - Include with every page -->
{% set container = fetch_container_instance() %}
<!-- script async src="{{ asset_url('fafrontend/js/banner.js') }}?v=1"></script -->
<script>var isAdBlocker = true;</script>
<script src="{{ asset_url('fafrontend/js/advertisement.js') }}"></script>
<script language="javascript" type="text/javascript">
//<![CDATA[
    $.ajax({
      url: '{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}',
      async: false,
      dataType: "script",
    });

    if (isAdBlocker == true) {
        $('.banner-center').html('');
    }

    {% if not app.request.get('is_copy') and not app.session.has('paa_fourth_step_brand') %}
        bindFormErrorEvents();
    {% endif %}
    customSelectOpenCloseEvents(false);
    $('.custom_select').select2({
        dropdownCssClass: 'custom_select_options',
    });

    $('.fa-select').selectmenu(
    {
        change: function(event, ui) {
            $('#'+$(this).attr('id')).trigger('change');
            $(this).nextAll('small.error').first().remove();
            $(this).parent().nextAll('small.error').first().remove();
            $('#'+$(this).attr('id')+'-button').removeClass('error-bdr');
        },
        open: function(event, ui) {
            //for fast click
            $('.ui-menu li').addClass('needsclick');
        },
        create: function(event, ui) {
            //for fast click
            if ($('#'+$(this).attr('id')).hasClass('error-bdr')) {
                $('#'+$(this).attr('id')+'-button').addClass('error-bdr');
            }
        }
    });

    $('.fa-select-white').selectmenu(
    {
        change: function(event, ui) {
            $('#'+$(this).attr('id')).trigger('change');
            $(this).nextAll('small.error').first().remove();
            $(this).parent().nextAll('small.error').first().remove();
            $('#'+$(this).attr('id')+'-button').removeClass('error-bdr');
        },
        open: function(event, ui) {
            //for fast click
            $('.ui-menu li').addClass('needsclick');
            $('.ui-menu').addClass('white-dropdown');
        },
        create: function(event, ui) {
            //for fast click
            if ($('#'+$(this).attr('id')).hasClass('error-bdr')) {
                $('#'+$(this).attr('id')+'-button').addClass('error-bdr');
            }
        }
    });

    $(window).on( "orientationchange", function( event ) {
        customSelectOpenCloseEvents(true);
        $('.fa-select').selectmenu('refresh');
        $('.fa-select-white').selectmenu('refresh');
    });

    $(document).ajaxStop(function () {
        $('.fa-select').selectmenu('refresh');
        $('.fa-select-white').selectmenu('refresh');
    });

    $('.custom_select').on("select2-focus", function(e) {
        $('.custom_select_options .select2-search').hide();
    })

    $('.fdatepicker').fdatepicker({format: 'dd/mm/yyyy'});
    $( "#mobile_search_li" ).click(function() {
        if ($('#top_bar_nav').hasClass('expanded')) {
                $('.top-bar, [data-topbar]').css('height', '').removeClass('expanded');
        }

        var searchIcon = $(this).first().children();
        if ($(this).first().children().hasClass('search')) {
            $(this).first().children().removeClass('search');
            $(this).first().children().addClass('search-on');
        } else {
            $(this).first().children().removeClass('search-on');
            $(this).first().children().addClass('search');
        }

        if ($('#top_search').hasClass('hide-for-small-only')) {
            $('#top_search').removeClass('hide-for-small-only');
        } else {
            $('#top_search').addClass('hide-for-small-only');
        }
    });


    $( "#mobile_menu_li" ).click(function() {
        if ($('#top_search').hasClass('hide-for-small-only') == false) {
            $('#top_search').addClass('hide-for-small-only');
        }
    });
    
    $(document).click(function (event) {
    	var screenWidth = $(window).width();
    	var offsetHeight = $('.moved > .dropdown').height();
    	if ($('.top-bar').hasClass('expanded') && screenWidth < '500' && (offsetHeight == null || offsetHeight > '300')) {
    		$('.discover-categories').css('margin-top', '17px');
    	} else {
    		$('.discover-categories').css('margin-top', '0px');
    	}
  	});
    
    var notification_box = true;
    
    $("#notification-l").hover(function() {
        if (notification_box == true) {
            displayNotifications();
        }
    }, function(){});
    
    
    function displayNotifications()
    {
        var route = Routing.generate('notification_show');
        $.ajax({
            type: "GET",
            url : route,
        })
        .done(function(response) {
            if (response) {
              $("#notification-area").html(response);
              var counter = parseInt($("#notification_head_counter").html());
              $("#notification_head_count").html(counter);
             notification_box = false;
            }
        });
    }
    
    function removeNotificationMessage(id)
    {
        var route = Routing.generate('notification_remove', { 'messsageId': id });
        $.ajax({
            type: "POST",
            url : route,
            data : {type: 'detail'},
        })
        .done(function(response) {
            notification_box = true;
            var counter = parseInt($("#notification_head_counter").html());
            $("#notification_head_counter").html(counter-1);
            $("#notification_head_count").html(counter-1);
            displayNotifications();
         });
    }

    var isOpened = {};
    function customSelectOpenCloseEvents(closeAllSelect)
    {
        var screenWidth = $(window).width();
        if (screenWidth <= 1024) {
            if (closeAllSelect) {
                $('.ui-selectmenu-button').each(function() {
                    var selectListId = $(this).attr('id').replace('-button', '-menu');
                    if (typeof isOpened[selectListId] != 'undefined' && isOpened[selectListId]) {
                        $('#'+selectListId).parent().removeClass('ui-selectmenu-open');
                        $('#'+selectListId).attr('aria-hidden', true);
                        isOpened[selectListId] = false;
                    }
                });
                $('.fa-select').selectmenu('close', true);
            } else {
                $('.ui-selectmenu-button').each(function() {
                    var selectListId = $(this).attr('id').replace('-button', '-menu');
                    isOpened[selectListId] = false;
                });

                $('html').on('click', function( e ) {
                    var container = $('.ui-selectmenu-button');
                    var event = e;
                    var eventTarget = e.target;

                    container.each(function() {
                        var selectListId = $(this).attr('id').replace('-button', '-menu');

                        if (!$(this).is(eventTarget) && $(this).has(eventTarget).length === 0) {
                            $('#'+selectListId).parent().removeClass('ui-selectmenu-open');
                            $('#'+selectListId).attr('aria-hidden', true);
                            isOpened[selectListId] = false;
                        } else {
                            if (typeof isOpened[selectListId] != 'undefined' && isOpened[selectListId]) {
                                $('#'+selectListId).parent().removeClass('ui-selectmenu-open');
                                $('#'+selectListId).attr('aria-hidden', true);
                                isOpened[selectListId] = false;
                            } else {
                                $('#'+selectListId).parent().addClass('ui-selectmenu-open');
                                $('#'+selectListId).attr('aria-hidden', false);
                                isOpened[selectListId] = true;
                            }
                        }
                    });
                });
            }
        }
    }
//]]>
</script>
{# <script src="//maps.googleapis.com/maps/api/js?v=3.exp&key={{container.getParameter('fa.googlemap.api.key')}}&sensor=true&libraries=adsense"></script> #}