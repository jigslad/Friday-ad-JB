<!-- Core Scripts - Include with every page -->
<script rel="script" type="application/javascript" src="{{ asset('js/bootstrap.min.js') }}"></script>
<script src="https://owlcarousel2.github.io/OwlCarousel2/assets/owlcarousel/owl.carousel.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/10.0.0/nouislider.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.12/js/select2.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

<script type="text/javascript" src="{{ asset('js/modernizr.custom.js') }}"></script>
<script type="text/javascript" src="{{ asset('js/jquery.dlmenu.js') }}"></script>
{# <script type="text/javascript" src="{{ asset('bundles/fafrontend/js/vendor/jquery-ui.min.js') }}"></script> #}
<script type="text/javascript" src="{{ asset('bundles/facore/js/common.js') }}"></script>
<script type="text/javascript" src="{{ asset('js/jquery.equalizer.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('bundles/facore/js/jquery.blockUI.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('bundles/facontent/fileman/js/custom.js') }}"></script>
<script type="text/javascript" src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
{#<script type="text/javascript" src="{{ asset('bundles/fafrontend/js/vendor/select2.min.js') }}"></script>#}
<script type="text/javascript" src="{{ asset('bundles/fafrontend/js/vendor/fastclick.js') }}"></script>
<script type="text/javascript" src="{{ asset('js/custom.js') }}"></script>

{% set container = fetch_container_instance() %}
<script>
    let isAdBlocker;
    isAdBlocker = false;
</script>
<script language="javascript" type="text/javascript">
//<![CDATA[
    $.ajax({
      url: '{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}',
      async: false,
      dataType: "script",
    });

    if (isAdBlocker == true) {
        $('.banner-center').html('');
    }

    var notification_box = true;
    $(window).on('load', function() {
        {% if not app.request.get('is_copy') and not app.session.has('paa_fourth_step_brand') %}
            bindFormErrorEvents();
        {% endif %}
        customSelectOpenCloseEvents(false);

        $('.fdatepicker').datepicker({format: 'dd/mm/yyyy'});

        /* $('.custom_select').select2({
            dropdownCssClass: 'custom_select_options',
        });*/

        $('.fa-select').selectmenu(
        {
            change: function(event, ui) {
                $('#'+$(this).attr('id')).trigger('change');
                $(this).nextAll('small.error').first().remove();
                $(this).parent().nextAll('small.error').first().remove();
                $('#'+$(this).attr('id')+'-button').removeClass('error-bdr');
            },
            open: function(event, ui) {
                //for fast click
                $('.ui-menu li').addClass('needsclick');
            },
            create: function(event, ui) {
                //for fast click
                if ($('#'+$(this).attr('id')).hasClass('error-bdr')) {
                    $('#'+$(this).attr('id')+'-button').addClass('error-bdr');
                }
            }
        });

        $('.fa-select-white').selectmenu(
        {
            change: function(event, ui) {
                $('#'+$(this).attr('id')).trigger('change');
                $(this).nextAll('small.error').first().remove();
                $(this).parent().nextAll('small.error').first().remove();
                $('#'+$(this).attr('id')+'-button').removeClass('error-bdr');
            },
            open: function(event, ui) {
                //for fast click
                $('.ui-menu li').addClass('needsclick');
                $('.ui-menu').addClass('white-dropdown');
            },
            create: function(event, ui) {
                //for fast click
                if ($('#'+$(this).attr('id')).hasClass('error-bdr')) {
                    $('#'+$(this).attr('id')+'-button').addClass('error-bdr');
                }
            }
        });

        $('.custom_select').on("select2-focus", function(e) {
            $('.custom_select_options .select2-search').hide();
        });


    });
    
    $(document).ready(
        function () {
            $('.select-control').select2();
        }
    );
        
    $(window).on( "orientationchange", function( event ) {
        customSelectOpenCloseEvents(true);
        $('.fa-select').selectmenu().selectmenu('refresh',true);
        $('.fa-select-white').selectmenu().selectmenu('refresh',true);
    });

    $(document).ajaxStop(function () {
        $('.fa-select').selectmenu().selectmenu('refresh',true);
        $('.fa-select-white').selectmenu().selectmenu('refresh',true);
    });

   
    $( "#mobile_search_li" ).click(function() {
        if ($('#top_bar_nav').hasClass('expanded')) {
                $('.top-bar, [data-topbar]').css('height', '').removeClass('expanded');
        }

        var searchIcon = $(this).first().children();
        if ($(this).first().children().hasClass('search')) {
            $(this).first().children().removeClass('search');
            $(this).first().children().addClass('search-on');
        } else {
            $(this).first().children().removeClass('search-on');
            $(this).first().children().addClass('search');
        }

        if ($('#top_search').hasClass('hide-for-small-only')) {
            $('#top_search').removeClass('hide-for-small-only');
        } else {
            $('#top_search').addClass('hide-for-small-only');
        }
    });


    $( "#mobile_menu_li" ).click(function() {
        if ($('#top_search').hasClass('hide-for-small-only') == false) {
            $('#top_search').addClass('hide-for-small-only');
        }
    });
    
    $(document).click(function (event) {
    	var screenWidth = $(window).width();
    	var offsetHeight = $('.moved > .dropdown').height();
    	if ($('.top-bar').hasClass('expanded') && screenWidth < '500' && (offsetHeight == null || offsetHeight > '300')) {
    		$('.discover-categories').css('margin-top', '17px');
    	} else {
    		$('.discover-categories').css('margin-top', '0px');
    	}
  	});
    
    
    $("#notification-l").hover(function() {
        if (notification_box == true) {
            displayNotifications();
        }
    }, function(){});
    
    
    function displayNotifications()
    {
        var route = Routing.generate('notification_show');
        $.ajax({
            type: "GET",
            url : route,
        })
        .done(function(response) {
            if (response) {
              $("#notification-area").html(response);
              var counter = parseInt($("#notification_head_counter").html());
              $("#notification_head_count").html(counter);
             notification_box = false;
            }
        });
    }
    
    function removeNotificationMessage(id)
    {
        var route = Routing.generate('notification_remove', { 'messsageId': id });
        $.ajax({
            type: "POST",
            url : route,
            data : {type: 'detail'},
        })
        .done(function(response) {
            notification_box = true;
            var counter = parseInt($("#notification_head_counter").html());
            $("#notification_head_counter").html(counter-1);
            $("#notification_head_count").html(counter-1);
            displayNotifications();
         });
    }

    var idClicked = '';var idFourthStepClicked = '';
    $("button[type=submit], input[type=submit]").click(function(e){
        var clickedId = $(this).attr('id');
        var parentForm = $(this).parents("form").attr('name');
        if(clickedId.match("^fa_paa_fourth_step_")) {
            idFourthStepClicked = clickedId;
            $('#'+idFourthStepClicked).attr('readonly', 'readonly');
        } else {
            idClicked = clickedId;
            if(!$('#'+idClicked).hasClass('disabled')) {
                $('#'+idClicked).attr('disabled', true);
            }
            $("form[name='"+parentForm+"']").submit();
        }
    });

    
    /*function loadSavingDataGif(formName) {
        $('#form-save-button-div').html('<button type="button" class="primary-btn-1 expand loading-in-button"><img src="{{ asset_url('facontent/fileman/images/loading-dir.gif') }}" style="margin-right:15px">Saving data...</button>');
        $('#'+formName+'_save').attr('disabled', true);
        $("form[name='"+formName+"']").submit();
    }*/

    var isOpened = {};
    function customSelectOpenCloseEvents(closeAllSelect)
    {
        var screenWidth = $(window).width();
        if (screenWidth <= 1024) {
            if (closeAllSelect) {
                $('.ui-selectmenu-button').each(function() {
                    var selectListId = $(this).attr('id').replace('-button', '-menu');
                    if (typeof isOpened[selectListId] != 'undefined' && isOpened[selectListId]) {
                        $('#'+selectListId).parent().removeClass('ui-selectmenu-open');
                        $('#'+selectListId).attr('aria-hidden', true);
                        isOpened[selectListId] = false;
                    }
                });
                $('.fa-select').selectmenu('close', true);
            } else {
                $('.ui-selectmenu-button').each(function() {
                    var selectListId = $(this).attr('id').replace('-button', '-menu');
                    isOpened[selectListId] = false;
                });

                $('html').on('click', function( e ) {
                    var container = $('.ui-selectmenu-button');
                    var event = e;
                    var eventTarget = e.target;

                    container.each(function() {
                        var selectListId = $(this).attr('id').replace('-button', '-menu');

                        if (!$(this).is(eventTarget) && $(this).has(eventTarget).length === 0) {
                            $('#'+selectListId).parent().removeClass('ui-selectmenu-open');
                            $('#'+selectListId).attr('aria-hidden', true);
                            isOpened[selectListId] = false;
                        } else {
                            if (typeof isOpened[selectListId] != 'undefined' && isOpened[selectListId]) {
                                $('#'+selectListId).parent().removeClass('ui-selectmenu-open');
                                $('#'+selectListId).attr('aria-hidden', true);
                                isOpened[selectListId] = false;
                            } else {
                                $('#'+selectListId).parent().addClass('ui-selectmenu-open');
                                $('#'+selectListId).attr('aria-hidden', false);
                                isOpened[selectListId] = true;
                            }
                        }
                    });
                });
            }
        }
    }

    $('.select-ctrl').each(function(){
        var $this = $(this), numberOfOptions = $(this).children('option').length;
      
        $this.addClass('select-hidden'); 
        $this.wrap('<div class="select"></div>');
        $this.after('<div class="select-styled"></div>');

        var $styledSelect = $this.next('div.select-styled');
        $styledSelect.text($this.children('option').eq(0).text());
      
        var $list = $('<ul />', {
            'class': 'select-options'
        }).insertAfter($styledSelect);
      
        for (var i = 0; i < numberOfOptions; i++) {
            $('<li />', {
                text: $this.children('option').eq(i).text(),
                rel: $this.children('option').eq(i).val()
            }).appendTo($list);
        }
      
        var $listItems = $list.children('li');
      
        $styledSelect.click(function(e) {
            e.stopPropagation();
            $('div.select-styled.active').not(this).each(function(){
                $(this).removeClass('active').next('ul.select-options').hide();
            });
            $(this).toggleClass('active').next('ul.select-options').toggle();
        });
      
        $listItems.click(function(e) {
            e.stopPropagation();
            $styledSelect.text($(this).text()).removeClass('active');
            $this.val($(this).attr('rel'));
            $list.hide();
            //console.log($this.val());
        });
      
        $(document).click(function() {
            $styledSelect.removeClass('active');
            $list.hide();
        });

    });

    $(document).ready(function(){
    	$("form[name='fa_user_half_account_email_only']").submit(function(event) {
            // Stop form from submitting normally
            event.preventDefault();

            bindHalfAccountSubmitFormEventEmailOnly('', 'ListingBottom');
        });
    	bindFormErrorEvents();
    });

    function bindHalfAccountSubmitFormEventEmailOnly(ad_id, callFrom)
    {
    	blockPage();
    	$.ajax({
            type: "POST",
            url: "{{path('user_half_account_create_email_only_ajax')}}",
            data: $('form[name="fa_user_half_account_email_only"]').serialize()
        })
        .done(function(response) {
            unblockPage();
            if (response.success.length && response.user_id) {
                saveSearchAgent(response.user_id, callFrom);
                $("#fa_user_half_account_email_only_email").val("");
            } else {
                $('#createAlertBlockError').remove();
                if (response.errorMessage.length) {
                    $("#fa_user_half_account_email_only_email").addClass("error");
                    $("<small id='createAlertBlockError' class='error'>"+response.errorMessage+"</span>").insertAfter('#fa_user_half_account_email_only_save');
                }
            }
        });
    }
   
//]]>
</script>
{# <script src="//maps.googleapis.com/maps/api/js?v=3.exp&key={{container.getParameter('fa.googlemap.api.key')}}&sensor=true&libraries=adsense"></script> #}