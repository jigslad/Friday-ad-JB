{% extends 'FaFrontendBundle::layout.html.twig' %}

{% set container = fetch_container_instance() %}
{% set seoManager = container.get('fa.seo.manager') %}
{% set categoryRepository = fetch_repository('FaEntityBundle:Category') %}
{% set adRepository = fetch_repository('FaAdBundle:Ad') %}
{% set adPropertyRepository = fetch_repository('FaAdBundle:AdProperty') %}
{% set adForSaleRepository = fetch_repository('FaAdBundle:AdForSale') %}
{% set seoToolRepository = fetch_repository('FaContentBundle:SeoTool') %}
{% set seoPageRule = {} %}
{% set seoPageRules = seoToolRepository.getSeoRulesKeyValueArray(constant('Fa\\Bundle\\ContentBundle\\Repository\\SeoToolRepository::HOME_PAGE'), container) %}
{% if seoPageRules[constant('Fa\\Bundle\\ContentBundle\\Repository\\SeoToolRepository::HOME_PAGE')~'_global'] is defined and seoPageRules[constant('Fa\\Bundle\\ContentBundle\\Repository\\SeoToolRepository::HOME_PAGE')~'_global']|length %}
    {% set seoPageRule = seoPageRules[constant('Fa\\Bundle\\ContentBundle\\Repository\\SeoToolRepository::HOME_PAGE')~'_global'] %}
{% endif %}
{% if seoPageRule|length %}
    {% set seoFields = staticCall('Fa\\Bundle\\CoreBundle\\Manager\\CommonManager', 'getSeoFields', [seoPageRule]) %}
{% endif %}

{% block page_title %}
    {% if seoFields.page_title is defined %}
        {{ seoManager.parseSeoString(seoFields.page_title, {'{location}': seoLocationName}) }}
    {% endif %}
{% endblock %}

{% block meta_description %}
    {% if seoFields.meta_description is defined %}
        {{ seoManager.parseSeoString(seoFields.meta_description, {'{location}': seoLocationName}) }}
    {% endif %}
{% endblock %}

{% block canonical_url %}
    {{ app.request.uri|replace({('?'~app.request.queryString) : ''}) }}
{% endblock %}

{% block meta_keywords %}
    {% if seoFields.meta_keywords is defined %}
        {{ seoManager.parseSeoString(seoFields.meta_keywords, {'{location}': seoLocationName}) }}
    {% endif %}
{% endblock %}
{% block scripttop %}
    {{ include('FaFrontendBundle:Default:home-css.html.twig') }}
{% endblock %}

{% set mobileDetectManager = container.get('fa.mobile.detect.manager') %}
{% set currentDevice = 'D' %}
{% if mobileDetectManager.isMobile() and not mobileDetectManager.isTablet() %}
    {% set currentDevice = 'M' %}
{% elseif mobileDetectManager.isMobile() and mobileDetectManager.isTablet() %}
    {% set currentDevice = 'T' %}
{% endif %}
    
{% block body %}
    <style>
        /* Select 2 css */
        .select2-container-multi, .select-control {
            width: 100% !important;
        }
        .select-control {
            margin-bottom: 30px;
        }
        .select2-container-multi .select2-choices, .select2-container .select2-choice, .select-control, .select-control:hover, .select-control:focus, .select-control:active   {
            border-radius: 4px !important;
        }
        .select2-search-choice {
            height: 30px !important;
            margin: 4px 0 0 4px !important;
            font-size: 14px !important;
            font-weight: 600 !important;
            letter-spacing: 0 !important;
            line-height: 21px !important;
            text-align: right !important;
            color: #ffffff !important;
            background: linear-gradient(135deg, #A75BD8 0%, #C60A84 100%) !important;
            border: 0px solid #9C1F9F !important;
            padding: .1875rem 1.5rem .1875rem 0.5rem !important;
        }
        .select2-search-choice-close {
            margin-right: 0px !important;
            float: right !important;
            margin-left: 4px !important;
            font-size: 24px !important;
            font-weight: bold !important;
            color: #ffffff !important;
            left: auto !important;
            background: url("data:image/svg+xml;charset=UTF-8,%3c?xml version='1.0' encoding='UTF-8'?%3e%3csvg width='24px' height='24px' viewBox='0 0 24 24' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3c!-- Generator: Sketch 63.1 (92452) - https://sketch.com --%3e%3ctitle%3eIcon / 24 / Functional / Cross%3c/title%3e%3cdesc%3eCreated with Sketch.%3c/desc%3e%3cg id='Icon-/-24-/-Functional-/-Cross' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3e%3cpolygon id='Shape' fill='%23ffffff' points='19 6.4 17.6 5 12 10.6 6.4 5 5 6.4 10.6 12 5 17.6 6.4 19 12 13.4 17.6 19 19 17.6 13.4 12'/%3e%3c/g%3e%3c/svg%3e") no-repeat !important;
            background-size: 18px 18px !important;
            width: 18px !important;
            height: 18px !important;
            right: 2px !important;
            top: 6px !important;
            opacity: 1 !important;
        }
        .select2-results .select2-result-label {
            padding: 10px 10px !important;
        }
        ul.select2-choices:after, .select2-choice:after {
            content: "";
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            border-top: 8px solid #CBD5D9;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
        }
        @media only screen and (max-width: 759px) {
            .mobile-p-0 {
                padding:0px !important;
            }
        }
        @media only screen and (min-width: 320px) and (max-width: 420px) {
            .discover-categories a {
                margin: 8px 8px 8px 8px !important;
                width: 27% !important;
                height: 80px !important;
            }
        }
        /* Select 2 css */
    </style>
    <div class="{% if currentRoute in {0: 'fa_frontend_homepage', 1: 'location_home_page'} %}homepage-hero{% endif %}">
        <div class="hero-img">
            {{ render(controller('FaAdBundle:AdList:topSearch', { 'searchParams': searchParams is defined ? searchParams : {}, 'isHomeSearch': true } )) }}
            <div class="parallax-window" id="header_image_div"></div>
        </div>
    </div>

    <div class="choose-cat-block" style="background: #212527; padding: 15px 0 40px;">
        {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}
        {{ form_errors(form) }}
        <div class="row">
            <div class="columns">
                {{ form_label(attribute(form, 'item__category_id', { 'attr' : {'class':'browse-by-category mt20' } } ) ) }}
                <div>
                    <div class="medium-12 columns mobile-p-0" style="padding-left: 0px;">
                        {{ form_widget(attribute(form, 'item__category_id'),{'attr':{ 'class': 'form-control select-control'  }}) }}
                    </div>
                    <div class="medium-5 columns mobile-p-0">
                        {{ form_widget(form.item__distance,{'attr':{'class':'form-control select-control'}}) }}
                    </div>
                    <div class="medium-7 columns mobile-p-0" style="display: inline-flex;">
                        <label style="padding: 10px 10px 10px 0px; color: #ffffff !important;">{{ 'from'|trans({}, 'frontend')}}</label>
                        {{ form_widget(form.item__location_autocomplete, {'attr': {'class': 'form-control select-control'}}) }}
                    </div>
                </div>
                <div>
                    <div class="medium-10 columns mobile-p-0" style="padding-left: 0px;">
                        <select id="menu">
                                <option>Pizza</option>
                                <option data-selected>Spaghetti</option>
                                <option>Mozzarella</option>
                                <option>Eggs</option>
                                <option data-selected>Eggs 2</option>
                                <option>Eggs 3</option>
                                <option>Water</option>
                                <option>Beer</option>
                                <option>Coke</option>
                                <option>Gin</option>
                        </select>
                        <script>
                            $("#menu").zmultiselect({

                                filter: true,
                                filterResult: true,
                                selectAll: true,
                                //locale: 'it-IT',

                                //REPLACE WITH CUSTOM TEXT:
                                //selectAllText: ['Check All', 'Uncheck All'],
                                //selectedText: ['Selected', 'of'],
                                //filterPlaceholder: 'What are your searching for?',
                                //filterResultText: "Showed",
                                //filterPlaceholder: 'MyFilter...',

                                get: "zmultiselect",
                                placeholder: "I'm a MultiSelect",
                                live: '#menu_live'
                            });
                        </script>


                        <select class="form-control select-control" id="multipleSelectExample" data-placeholder="Choose services" multiple="">
                            <option value="">Choose services</option>
                            <option value="1">Option 1</option>
                            <option value="1">Option 1</option>
                            <option value="2">Option 2</option>
                            <option value="3">Option 3</option>
                            <option value="4">Option 4</option>
                            <option value="5">Option 5</option>
                        </select>
                    </div>
                    <div class="medium-7 columns mobile-p-0">
                        <input type="radio" id="indepandent" name="type" value="indepandent">
                        <label for="indepandent">indepandent</label>
                        <input type="radio" id="agency" name="type" value="agency">
                        <label for="agency">agency</label>
                    </div>
                    <div class="medium-7 columns mobile-p-0" style="display: inline-flex;">
                        {{ form_widget(attribute(form, 'item_adult__ethnicity_id'),{'attr':{ 'class': 'form-control select-control'  }}) }}
                    </div>
                </div>
            </div>

            <div class="small-wrapper">
                <button class="secondary-btn-1 expand button mb0 mt20" type="submit">{{ 'Search'|trans({}, 'frontend-left-search') }}</button>
            </div>
        </div>
        {{ form_end(form) }}
    </div>
    <div class="what-u-discover">
        <div class="row">
            <div class="columns">
                {% set adultContactId = constant('Fa\\Bundle\\EntityBundle\\Repository\\CategoryRepository::ADULT_CONTACTS_ID') %}
                {% set escortsId = constant('Fa\\Bundle\\EntityBundle\\Repository\\CategoryRepository::ESCORT_SERVICES_ID') %}
                {% set fetishRoleplayId = constant('Fa\\Bundle\\EntityBundle\\Repository\\CategoryRepository::FETISH_AND_ROLE_PLAY_ID') %}
                {% set gayMaleEscortId = constant('Fa\\Bundle\\EntityBundle\\Repository\\CategoryRepository::GAY_MALE_ESCORT_ID') %}
                {% set adultIndustryJobsId = constant('Fa\\Bundle\\EntityBundle\\Repository\\CategoryRepository::ADULT_INDUSTRY_JOBS_ID') %}
                {% set adultMassageId = constant('Fa\\Bundle\\EntityBundle\\Repository\\CategoryRepository::ADULT_MASSAGE_ID') %}
                
                {% set locationId = '' %}
                {% if cookieLocationDetails is defined and cookieLocationDetails is not null and cookieLocationDetails.location is defined and cookieLocationDetails.location %}
                    {% set locationId = cookieLocationDetails.location %}
                {% endif %}
                {# {% cache 'home|page|'~locationId~'front/home_page_discover' 1800 %} #}
                <div class="discover-categories large-20 discover-adult-categories">
                    {% set linkParams = { 'item__location': locationId, 'item__category_id': adultContactId } %}
                    <a href="{{ container.get('fa_ad.manager.ad_routing').getListingUrl(linkParams) }}" class="discover-adult-contacts">{{'Adult Contacts'|trans({}, 'frontend-homepage')}}</a>

                    {% set linkParams = { 'item__location': locationId, 'item__category_id': escortsId } %}
                    <a href="{{ container.get('fa_ad.manager.ad_routing').getListingUrl(linkParams) }}" class="discover-escorts">{{'Escorts'|trans({}, 'frontend-homepage')}}</a>

                    {% set linkParams = { 'item__location': locationId, 'item__category_id': fetishRoleplayId } %}
                    <a href="{{ container.get('fa_ad.manager.ad_routing').getListingUrl(linkParams) }}" class="discover-fetish-and-roleplay">{{'Fetish and Role Play'|trans({}, 'frontend-homepage')}}</a>

                    {% set linkParams = { 'item__location': locationId, 'item__category_id': gayMaleEscortId } %}
                    <a href="{{ container.get('fa_ad.manager.ad_routing').getListingUrl(linkParams) }}" class="discover-gay-male-escort">{{'Gay Male Escort'|trans({}, 'frontend-homepage')}}</a>

                    {% set linkParams = { 'item__location': locationId, 'item__category_id': adultIndustryJobsId } %}
                    <a href="{{ container.get('fa_ad.manager.ad_routing').getListingUrl(linkParams) }}" class="discover-adult-industry-jobs">{{'Adult Industry Jobs'|trans({}, 'frontend-homepage')}}</a>

                    {% set linkParams = { 'item__location': locationId, 'item__category_id': adultMassageId } %}
                    <a href="{{ container.get('fa_ad.manager.ad_routing').getListingUrl(linkParams) }}" class="discover-adult-massage">{{'Adult Massage'|trans({}, 'frontend-homepage')}}</a>
                </div>
                    {# {% endcache %} #}
            </div>
        </div>
    </div>

    <div class="homepage-row">
        <div class="row">
            <div class="columns">
                <h3 class="homepage-title">{{'Popular searches'|trans({}, 'frontend-homepage')}}</h3>
                {{ include('FaFrontendBundle:Adult:homePopularSearches.html.twig', {'divId': 'recommended-item-slider', 'ads': ''}) }}
            </div>
        </div>
    </div>
    
    {% if latestAds|length %}
        <div class="homepage-row latest-items">
            <div class="row">
                <div class="columns">
                    <h3 class="homepage-title">
                        {% if locationName is not null %}
                            {{'Latest in %locationName%'|trans({'%locationName%': locationName}, 'frontend-homepage')}}
                        {% else %}
                            {{'Latest ads'|trans({}, 'frontend-homepage')}}
                        {% endif %}
                    </h3>
                    {{ include('FaFrontendBundle:Default:homePageLatestAdsSlider.html.twig', {'divId': 'latest-item-slider'}) }}
                    {% if searchResultUrl is not null%}
                        <div class="small-wrapper">
                            <a href="{{ searchResultUrl }}" class="secondary-btn-1 expand button mb0" rel="nofollow">{{'View all'|trans({}, 'frontend-homepage')}}</a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    {% endif %}

	{% if businessExposureUsersDetails|length %}
    <div class="homepage-row">
        <div class="row">
            <div class="columns">
                <h3 class="homepage-title">{{'Featured Advertisers'|trans({}, 'frontend-homepage')}}</h3>
            </div>
            <div class="columns">
                {{ include('FaFrontendBundle:Adult:homePageFeaturedAdvertisers.html.twig') }}
            </div>
        </div>
    </div>
	{% endif %}
	
	{% if externalSiteBlogDetails|length %}
    <div class="homepage-row">
        <div class="row">
            <div class="columns">
                <h3 class="homepage-title">{{'Latest Ads'|trans({}, 'frontend-homepage')}}</h3>
                {{ include('FaFrontendBundle:Adult:homePageLatestAds.html.twig', {'divId': 'featured-item-slider'}) }}
            </div>
        </div>
    </div>

    <div class="homepage-row">
        <div class="row">
            <div class="columns">
                <h3 class="homepage-title">{{'Latest from the blog'|trans({}, 'frontend-homepage')}}</h3>
             </div>
                {{ include('FaFrontendBundle:Adult:homePageLatestBlog.html.twig', {'divId': 'recently-viwed-item-slider', 'ads': '', noImageColor:'grey'}) }}
            </div>
        </div>
    </div>
	{% endif %}
	
	<div class="homepage-row white-bg">
    {% if mobileDetectManager.isMobile() %}
        {% set zoneId = constant('Fa\\Bundle\\ContentBundle\\Repository\\BannerZoneRepository::ZONE_HOMEPAGE_RECTANGLE_BLOCK_MOBILE') %}
        {{ include('FaContentBundle:Banner:show.html.twig', {'zone_id': zoneId}) }}
    {% else %}
        {% set zoneId = constant('Fa\\Bundle\\ContentBundle\\Repository\\BannerZoneRepository::ZONE_HOMEPAGE_RECTANGLE_BLOCK') %}
        {{ include('FaContentBundle:Banner:show.html.twig', {'zone_id': zoneId, 'otherParams':{'class':'hide-for-small-only'}}) }}    	
    {% endif %}
    </div>
	
    <div class="homepage-row">
        <div class="row">
            <div class="columns">
                <h3 class="homepage-title">{{'Browse adverts in popular locations'|trans({}, 'frontend-homepage')}}</h3>
                {# {% cache 'home|page|location|block'~currentDevice 3600 %} #}
                    {{ render(controller('FaFrontendBundle:Adult:showAdultHomePageLocationBlocks')) }}
                {# {% endcache %} #}
            </div>
        </div>
    </div>
{% endblock %}


{% block scriptbottom %}
    {% javascripts filter='uglifyjs2' output='bundles/js/compiled/home.js'
        'bundles/facore/js/owl.carousel.min.js'
        'bundles/fafrontend/js/parallax.min.js'
    %}
    <script defer src="{{ static_asset_url(asset_url) }}"></script>
    {% endjavascripts %}
    
    {% set mobileDetectManager = container.get('fa.mobile.detect.manager') %}
    {% if mobileDetectManager.is('IE') %}
        {% javascripts filter='uglifyjs2' output='bundles/js/compiled/parallaxFix.js'
            'bundles/fafrontend/js/scroll.js'
            'bundles/fafrontend/js/TweenMax.min.js'
        %}
        <script src="{{ static_asset_url(asset_url) }}"></script>
        {% endjavascripts %}
    {% endif %}
    <script language="javascript" type="text/javascript">
    //<![CDATA[
    {% if mobileDetectManager.is('IE') %}
        $(function(){   
            var $window = $(window);
            var scrollTime = 1.2;
            var scrollDistance = 250;
            $window.on("mousewheel DOMMouseScroll", function(event){
                event.preventDefault(); 
                var delta = event.originalEvent.wheelDelta/120 || -event.originalEvent.detail/3;
                var scrollTop = $window.scrollTop();
                var finalScroll = scrollTop - parseInt(delta*scrollDistance);
                TweenMax.to($window, scrollTime, {
                    scrollTo : { y: finalScroll, autoKill:true },
                        ease: Power1.easeOut,
                        overwrite: 1                            
                    });
            });
        });
    {% endif %}

    var headerParallax;
    $(document).ready(function() {
        $('div.homepage-row:even').addClass('white-bg');
        getHeaderImage();
        var featuredAdvertisersItemSlider = $("#featured_advertisers_slider");
        featuredAdvertisersItemSlider.owlCarousel({
            items : 4,
            itemsCustom:[[320, 1], [568, 2], [768, 3], [1024, 4]],
            navigation: true,
            pagination:false,
            responsiveRefreshRate : 100,
            navigationText: ['<img src="{{ asset_url('fafrontend/images/small-slider-prev.svg') }}" alt="" />', '<img src="{{ asset_url('fafrontend/images/small-slider-next.svg') }}" alt="" />'],
            lazyLoad: true,
            scrollPerPage: true,
        });

        

        var featuredItemSlider = $("#featured-item-slider");
        featuredItemSlider.owlCarousel({
            items : 3,
            itemsCustom:[[320, 1], [568, 2], [768, 3], [1024, 3]],
            navigation: true,
            pagination:false,
            responsiveRefreshRate : 100,
            navigationText: ['<img src="{{ asset_url('fafrontend/images/small-slider-prev.svg') }}" alt="" />', '<img src="{{ asset_url('fafrontend/images/small-slider-next.svg') }}" alt="" />'],
            lazyLoad: true,
            scrollPerPage: true,
        });

        var recentlyViwedItemSlider = $("#recently-viwed-item-slider");
        recentlyViwedItemSlider.owlCarousel({
            items : 6,
            itemsCustom:[[320, 1], [568, 3], [768, 4], [1024, 5], [1151, 6]],
            navigation: true,
            pagination:false,
            responsiveRefreshRate : 100,
            navigationText: ['<img src="{{ asset_url('fafrontend/images/small-slider-prev.svg') }}" alt="" />', '<img src="{{ asset_url('fafrontend/images/small-slider-next.svg') }}" alt="" />'],
            lazyLoad: true,
            scrollPerPage: true,
        });

        var popularShopsSlider = $("#popular_shops_slider");
        if (popularShopsSlider) {
            popularShopsSlider.owlCarousel({
                items : 4,
                itemsCustom:[[320, 1], [568, 2], [768, 3], [1024, 4]],
                navigation: true,
                pagination:false,
                responsiveRefreshRate : 100,
                navigationText: ['<img src="{{ asset_url('fafrontend/images/small-slider-prev.svg') }}" alt="" />', '<img src="{{ asset_url('fafrontend/images/small-slider-next.svg') }}" alt="" />'],
                lazyLoad: true,
                scrollPerPage: true,
            });
        }

        $(document).foundation({
            accordion: {
                multi_expand: true,
                callback : function (accordion) {
                    accordionCallback(accordion);
                }
            }
        });
    });

    $( window ).scroll(function() {
        if ($("#sticky_nav").hasClass('fixed')) {
            $("#sticky_nav_top").addClass('fixed');
            $("#sticky_nav_top").addClass('top-bar-shadow');
        } else {
            $("#sticky_nav_top").removeClass('fixed');
            $("#sticky_nav_top").removeClass('top-bar-shadow');
        }
    });

    function accordionCallback(accordion)
    {
        $(accordion).siblings('a').find('i').toggleClass("fi-plus fi-minus");
        $(accordion).find('select.fa-select').selectmenu().selectmenu('refresh',true);
    }
    
    function getHeaderImage()
    {
        var viewPort = getViewport();
        $.ajax({
            type: "POST",
            url : '{{ path('ajax_get_header_image') }}',
            data : {'screenWidth': viewPort.width, 'location': '{{ app.request.get('location') }}'},
        })
        .done(function(response) {
            if (response.image) {
                headerParallax = $('#header_image_div').parallax({imageSrc: response.image, naturalWidth: response.width, naturalHeight: response.height});
                if (response.phone_image && response.phone_image_url)
                    $(".forsale-phone").html('<a href="'+response.phone_image_url+'"><img src="'+response.phone_image+'"></a>');
                else if (response.phone_image)
                    $(".forsale-phone").html('<img src="'+response.phone_image+'">');
            } else {
                $('#header_image_div').parallax({imageSrc: "{{ asset_url('/fafrontend/images/home-slider.png') }}" });
            }
        });
    }
    //]]>
    </script>
{% endblock %}
{% block dimension2 %}
<script language="javascript" type="text/javascript">
//<![CDATA[
{% if app.user.getId() is not defined or app.user.getId() is null %}
	ga('set', 'dimension9', 'not logged in');
{% else %}
	ga('set', 'dimension9', 'logged in');
{% endif %}
           
    ga('send', 'pageview', {'dimension1': defLocationText, 'dimension2':  'Homepage'{% if app.request.get('ti_url') %} ,'dimension8': '{{ app.request.get('ti_url') }}' {% endif %}});
//]]>
</script>
{% endblock %}
