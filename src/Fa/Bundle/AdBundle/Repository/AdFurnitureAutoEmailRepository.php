<?php

/**
 * This file is part of the fa bundle.
 *
 * @copyright Copyright (c) 2014, FMG
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */

namespace Fa\Bundle\AdBundle\Repository;

use Doctrine\ORM\EntityRepository;
use Doctrine\ORM\ORMException;
use Fa\Bundle\AdBundle\Entity\AdFurnitureAutoEmail;

/**
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 *
 * @author Konda Reddy <konda.reddy@firdaymediagroup.com>
 * @copyright 2014 Friday Media Group Ltd
 * @version v1.0
 */
class AdFurnitureAutoEmailRepository extends EntityRepository
{
    /**
     * @global string Email Rotation Data
     */
    const EMAIL_ONCE_IN = '3';


    /**
     * @param integer $userId
     * @param string $email_sent_date
     * @return bool|AdFurnitureAutoEmail|object|null
     */
    public function insertOrUpdateAdFurnitureAutoEmail($userId, $email_sent_date){
        $emailSentDate = $this->findOneBy(array('user_id'=>$userId));
        if(!$emailSentDate) {
            $emailSentDate->setEmailSentDate();
        }
        else{
            $emailSentDate = new AdFurnitureAutoEmail();
            $emailSentDate->setUserId($userId);
            $emailSentDate->setEmailSentDate($email_sent_date);
        }
        try {
            $this->getEntityManager()->persist($emailSentDate);
            $this->getEntityManager()->flush();
            return $emailSentDate;
        } catch (ORMException $e) {
            return false;
        }
    }

    /**
     * @return string
     */
    public function getEmailRotation(){
        return $this::EMAIL_ONCE_IN;
    }
}