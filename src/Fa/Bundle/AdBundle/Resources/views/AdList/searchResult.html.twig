{% extends 'FaFrontendBundle::layout.html.twig' %}
{% set container = fetch_container_instance() %}
{% set seoManager = container.get('fa.seo.manager') %}
{% set seoToolRepository = fetch_repository('FaContentBundle:SeoTool') %}
{% set categoryRepository = fetch_repository('FaEntityBundle:Category') %}

{% set seoPageRule = {} %}
{% set seoFields = {} %}
{% set customized_url = app.request.get('customized_page')  %}
{% set catSrchString = null %}
{% set recommendedSlotsCount = recommendedSlotResult|length %}
{% if recommendedSlotsCount > 0 %}
    {% set displayRecommendedSlot = 1 %}
{% else %}
    {% set displayRecommendedSlot = 0 %}
{% endif %}

{% set totalAdCount = (pagination.getNbResults())?(pagination.getNbResults()|length):0 %}

{% set businessExposureUsersCount = (businessExposureUsersDetails is defined )?(businessExposureUsersDetails|length) :0%}
{% set topAdCount = (topAdResult is defined)?topAdResult|length:0 %}

{% set selCatName = '' %}
{% set selCatSlug = '' %}
{% set selCatNoIndex = '' %}
{% set selCatNoFollow = '' %}
{% set selNoIndex = '' %}
{% set selNoFollow = '' %}

{% if searchParams is defined and searchParams.item__category_id is defined and searchParams.item__category_id is not null %}    
    {% set selCatDet = categoryRepository.getCategoryArrayById(searchParams.item__category_id) %}
    {% if selCatDet is defined %}
        {% set selCatName = selCatDet['name'] %}
        {% set selCatSlug = selCatDet['slug'] %}
        {% set selCatNoIndex = selCatDet['no_index'] %}
        {% set selCatNoFollow = selCatDet['no_follow'] %}
        {% set selNoIndex = (selCatNoIndex==1)?'noindex':'index' %}
        {% set selNoFollow = (selCatNoFollow==1)?'nofollow':'follow' %}
    {% endif %}
    {% if customized_url|length %}
        {% set seoPageRule = seoToolRepository.getSeoPageRuleDetailForListResult(constant('Fa\\Bundle\\ContentBundle\\Repository\\SeoToolRepository::ADVERT_LIST_PAGE'), customized_url['target_url'], container) %}
    {% else %}
        {% set seoPageRule = seoToolRepository.getSeoPageRuleDetailForListResult(constant('Fa\\Bundle\\ContentBundle\\Repository\\SeoToolRepository::ADVERT_LIST_PAGE'), searchParams.item__category_id, container) %}
    {% endif %}
{% endif %}

{% if not seoPageRule|length %}
    {% set seoPageRule = seoToolRepository.getSeoPageRuleDetailForListResult(constant('Fa\\Bundle\\ContentBundle\\Repository\\SeoToolRepository::ADVERT_LIST_PAGE'), null, container) %}
{% endif %}

{% if (objSeoToolOverride|length) %}
    {% if isClassicCarPage is defined and isClassicCarPage==1 %}
         {% set seoPageRule = seoPageRule|merge({'h1_tag': objSeoToolOverride.getH1Tag()|replace({'{Manufacturer}': ((selCatName!='Cars')?selCatName:'')}), 'page_title': (objSeoToolOverride.getPageTitle()~' - '~resultCount) |replace({'{Manufacturer}':((selCatName!='Cars')?selCatName:'')}), 'meta_description': objSeoToolOverride.getMetaDescription()|replace({'{Manufacturer}': ((selCatName!='Cars')?selCatName:'')}), 'meta_keywords':  ((selCatName!='Cars')?selCatName:'')~' Classic cars for sale - '~resultCount~' results', 'no_index': 0, 'no_follow': 0, 'canonical_url': app.request.uri}) %} 
    {% else %}
    {% set seoPageRule = seoPageRule|merge({'h1_tag': objSeoToolOverride.getH1Tag(), 'page_title': objSeoToolOverride.getPageTitle(), 'meta_description': objSeoToolOverride.getMetaDescription(), 'no_index': objSeoToolOverride.getNoIndex(), 'no_follow': objSeoToolOverride.getNoFollow(), 'canonical_url': objSeoToolOverride.getCanonicalUrl()}) %}
{% endif %}
{% endif %}

{% if seoPageRule|length %}
    {% set seoFields = staticCall('Fa\\Bundle\\CoreBundle\\Manager\\CommonManager', 'getSeoFields', [seoPageRule]) %}
{% endif %}
{% if app.request.queryString or '/search' in app.request.uri %}
    {% set isUrlIndexable = false %}
{% else %}
    {% set isUrlIndexable = fetch_repository('FaEntityBundle:CategoryDimension').isUrlIndexableBySearchParams(searchParams, container) %}
{% endif %}

{% block meta_robots %}
    {% set metaRobotsArray = {} %}
    {% if not pagination.getNbResults() %}
        noindex, follow
        {% set metaRobotsArray = {0: 'noindex', 1: 'follow'} %}
    {% elseif extendedResultCount>0 and app.request.get('page') > defaultPages %}
        noindex, follow
        {% set metaRobotsArray = {0: 'noindex', 1: 'follow'} %}
    {% elseif 'motors/cars-under-1000' in app.request.uri or 'motors/cars-under-500' in app.request.uri  or 'motors/left-hand-drive-cars/' in app.request.uri %}
    	index, follow
        {% set metaRobotsArray = {0: 'index', 1: 'follow'} %}
    {% elseif isClassicCarPage is defined and isClassicCarPage==1 %}
        index, follow
        {% set metaRobotsArray = {0: 'index', 1: 'follow'} %}
    {% elseif 'item__distance=0' in app.request.queryString %}
        noindex, follow
        {% set metaRobotsArray = {0: 'noindex', 1: 'follow'} %}
    {% elseif selCatNoIndex==1 or selCatNoFollow==1 %}
    	{{selNoIndex}}, {{ selNoFollow }} 
    	{% set metaRobotsArray = {0: selNoIndex, 1: selNoFollow} %}
    {% elseif 'item__distance=0' not in app.request.queryString %}
        {% if customized_url|length %}
            {% if seoFields.meta_robots is defined %}
                {{seoFields.meta_robots}}
                {% set metaRobotsArray = seoFields.meta_robots|split(', ') %}
             {% else %}
                index, follow
                {% set metaRobotsArray = {0: 'index', 1: 'follow'} %}
            {% endif %}
        {% else %}
            {% if isUrlIndexable == false %}
                noindex, follow
                {% set metaRobotsArray = {0: 'noindex', 1: 'follow'} %}
            {% else %}
                {% if seoFields.meta_robots is defined %}
                    {{seoFields.meta_robots}}
                    {% set metaRobotsArray = seoFields.meta_robots|split(', ') %}
                {% endif %}
            {% endif %}
        {% endif %}
    {% endif %}
    {{ set_variables('metaRobots', {'metaRobotsArray': metaRobotsArray}) }}
{% endblock %}

{% block page_title %}
    {% if seoFields.page_title is defined %}
        {{ seoManager.parseSeoStringForAdList(seoFields.page_title, searchParams, cookieLocationDetails) }}
    {% elseif app.request.queryString %}
        {% if searchParams is defined and searchParams.item__category_id is defined and searchParams.item__category_id is not null %}
            {{ fa_entity_cache_manager.getEntityNameById('FaEntityBundle:Category', searchParams.item__category_id)}} | Friday-Ad
        {% else %}
            Friday-Ad
        {% endif %}    
    {% endif %}
{% endblock %}

{% block meta_description %}
    {% if seoFields.meta_description is defined %}
            {{ seoManager.parseSeoStringForAdList(seoFields.meta_description, searchParams, cookieLocationDetails) }}
    {% elseif app.request.queryString %}
        {% if searchParams is defined and searchParams.item__category_id is defined and searchParams.item__category_id is not null %}
            {{'%resultCount% results in %category%'|trans({'%resultCount%': resultCount, '%category%': fa_entity_cache_manager.getEntityNameById('FaEntityBundle:Category', searchParams.item__category_id)}, 'frontend-search-result')}}
        {% else %}
            {{'%resultCount% results'|trans({'%resultCount%': resultCount}, 'frontend-search-result')}}
        {% endif %}
    {% endif %}
{% endblock %}

{% block meta_keywords %}
    {% if seoFields.meta_keywords is defined %}
        {{ seoManager.parseSeoStringForAdList(seoFields.meta_keywords, searchParams, cookieLocationDetails) }}
    {% elseif app.request.queryString %}
        no-keywords
    {% endif %}
{% endblock %}

{% block canonical_url %}
    {% set metaRobotsArray = get_variables('metaRobots').metaRobotsArray %}
    {% if not metaRobotsArray|length or (metaRobotsArray|length and metaRobotsArray[0] is defined and metaRobotsArray[0] != 'noindex') or (metaRobotsArray|length and metaRobotsArray[0] is defined and metaRobotsArray[0] == 'index' and metaRobotsArray[1] is defined and metaRobotsArray[1] != 'nofollow') %}
        {% if seoFields.canonical_url is defined %}
            {% set seoCanonicalUrl = replace_case_insensitive('{Location}', app.request.get('location'), seoFields.canonical_url) %}
            {{ seoManager.parseSeoStringForAdList(seoCanonicalUrl, searchParams, cookieLocationDetails,true) }}
        {% else %}
            {{ app.request.uri|replace({('?'~app.request.queryString) : ''})}}
        {% endif %}
    {% else %}
        {{ app.request.uri|replace({('?'~app.request.queryString) : ''})}}
    {% endif %}
{% endblock %}
    
{% block breadcrumb_script %}
	{% set location_id = null %}
    {% if cookieLocationDetails['location'] is defined %}
        {% set location_id = cookieLocationDetails['location'] %}
    {% endif %}
    {% set locality_id = null %}
    {% if cookieLocationDetails['locality_id'] is defined %}
        {% set locality_id = cookieLocationDetails['locality_id'] %}
    {% endif %}

    {% if location_id and location_id != constant('Fa\\Bundle\\EntityBundle\\Repository\\LocationRepository::COUNTY_ID') %} 
        {% set HomePagePath = container.getParameter('base_url')~path('location_home_page', {'location': app.request.get('location')}) %} 
    {% else %}
        {% set HomePagePath =  container.getParameter('base_url')~path('fa_frontend_homepage') %}  
    {% endif %}

    {% set locationName = '' %}
    {% if location_id == 2 %}
        {% set locationName = 'Homepage' %}
    {% else %}
        {% set locationName = app.request.get('location')|capitalize %}
    {% endif %}

	<script type="application/ld+json">
	{
  		"@context": "https://schema.org",
  		"@type": "BreadcrumbList",
  		"itemListElement": [{
    	"@type": "ListItem",
    	"position": 1,
    	"name": "{{locationName}}",
    	"item": "{{HomePagePath}}"
  	},
    {% set categoryPath = {} %}
    {% if searchParams is defined and searchParams.item__category_id is defined and searchParams.item__category_id is not null %}
        {% set categoryPath = fetch_repository('FaEntityBundle:Category').getCategoryPathArrayById(searchParams.item__category_id, false, fetch_container_instance()) %}
        {% if categoryPath|length > 0 %}  
			{% set breadcrumbCatCnt = 2 %}      	
            {% for categoryId, categoryName in categoryPath %}
                {% set catLinkParam = { 'item__location': location_id, 'item__category_id': categoryId} %}
                {% set catListUrl = container.getParameter('base_url')~container.get('fa_ad.manager.ad_routing').getListingUrl(catLinkParam) %}
{
    	"@type": "ListItem",
    	"position": {{breadcrumbCatCnt}},
    	"name": "{{categoryName}}",
    	"item": "{{catListUrl}}"
  	}{% if breadcrumbCatCnt <= categoryPath|length %},{% endif %}    
				{% set breadcrumbCatCnt = breadcrumbCatCnt + 1 %}
            {% endfor %}
        {% endif %}
    {% endif %}
     ]
	}
</script>
{% endblock %}
{% block stylesheet %}
	<link rel="stylesheet" href="{{ asset('/build/css/adlist.css') }}">
{% endblock %}
{% block scripttop %}
    {% if (profileExposureUserAds is defined and profileUserId is defined and profileUserDetail is defined and profileUserDetail|length) or (businessExposureUsersDetails is defined and businessExposureUsersDetails|length) %}
        {#{ include('FaFrontendBundle:Default:home-css.html.twig') }#}
        {# { include('FaAdBundle:AdList:owl-carousel-2-css.html.twig') } #}
    {% endif %}    
{% endblock %}

{% block body %}
{% if displayRecommendedSlot is defined and displayRecommendedSlot==1 %}
    <link rel="stylesheet" href="{{ asset('/build/css/adlist-recommended.css') }}">
{% endif %}

{% set entityCacheManager = container.get('fa.entity.cache.manager') %}
{{ include('FaAdBundle:AdList:searchResultHeader.html.twig') }}
{% set mobileDetectManager = container.get('fa.mobile.detect.manager') %}
{% if searchParams is defined and searchParams.item__category_id is defined and searchParams.item__category_id is not null %}
    {% set categorySrchPath = categoryRepository.getCategoryPathArrayById(searchParams.item__category_id, false, container) %}
    {% for categoryId,categoryName in categorySrchPath %}
        {% set catSrchString = catSrchString ~ '-' ~ categoryName %}
    {% endfor %}
    {{ set_variables('SrchCatDetails', {'catSrchString':catSrchString}) }}
{% endif %}

<div class="banner-wrapper clearfix">
	<div class="container">
        <div class="row results-main banner-mid-column">
            <div id="left_search" class="col-md-9 col-lg-6 left-search-block">
				<div class="search-filters">
                    <a href="javascript:void(0);" rel="nofollow" class="left-search-close search-close" onclick="return showLeftSearch(false);">search-close</a>
                    {% if isShopPage is not defined %}
                        {{ include('FaAdBundle:AdList:saveSearch.html.twig') }}
                    {% endif %}
                    <div class="d-block d-md-block d-lg-none hide_sort_menu"><a href="javascript:void(0);" class="search-close"></a></div>
                    {{ render(controller('FaAdBundle:AdList:leftSearch', { 'searchParams': searchParams is defined ? searchParams : {} , 'locationFacets': locationFacets, 'facetResult': facetResult, 'searchQueryString': app.request.queryString, 'customized_url': customized_url, 'cookieLocationDetails': cookieLocationDetails is defined ? cookieLocationDetails : {}} )) }}
                </div>
                <div class="reset-search clearfix">
                    {% if isShopPage is defined and isShopPage %}
                        {% set profileAdsUrl = container.get('fa_ad.manager.ad_routing').getProfilePageAdsUrl(searchParams['item__user_id']) %}
                        <a href="{{ profileAdsUrl }}" title="{{ 'Reset search'|trans({}, 'frontend-left-search') }}">{{ 'Reset search'|trans({}, 'frontend-left-search') }}</a>
                    {% else %}
                        <a href="javascript:void(0)" rel="nofollow" id="reset_search" title="{{ 'Reset search'|trans({}, 'frontend-left-search') }}">{{ 'Reset search'|trans({}, 'frontend-left-search') }}</a>
                    {% endif %}
                </div>
    
                {% if seoFields|length and seoFields['popular_search'] is defined and seoFields['popular_search'] and seoFields['seo_tool_id'] is defined and seoFields['seo_tool_id'] %}
                    {{ include('FaAdBundle:AdList:leftPopularSearchLinks.html.twig', {'mapFlag': 0}) }}                  
                {% endif %}
    
                {% set zoneId = constant('Fa\\Bundle\\ContentBundle\\Repository\\BannerZoneRepository::ZONE_SR_BELOW_FILTERBOX') %}
                {{ include('FaContentBundle:Banner:show.html.twig', {'zone_id': zoneId}) }}
           	</div>
           	
           	<div class="col-md-24 col-lg-18 right-search-block">
           	    {% if pagination.getNbResults() %}
                    {% if isShopPage is not defined %}
                    	<div class="mobile-create-alert-box d-block d-lg-none mb20">
                            {{ include('FaAdBundle:AdList:saveSearch.html.twig') }}
                        </div>
                    {% endif %}
                {% endif %}
                <div id="listingDiv" class="row-block">
                	<ul>
                	{% set slotallocated = [] %}
                    {% if displayRecommendedSlot==1 and recommendedSlotsCount > 0 and totalAdCount > 0 and (recommendedSlotResult[1] is defined and recommendedSlotResult[1]|length >0) %}
                        <li>{{ include('FaAdBundle:AdList:showRecommendedSlots.html.twig', {'slotIndex': 1 }) }}</li>
                        {% set slotallocated = slotallocated|merge([1]) %}
                    {% endif %}
        
                    {% if businessTopExposureUsersDetailsWithoutAd is defined  %}
                        {#{ include('FaAdBundle:AdList:businessTopExposureSingleBlock.html.twig', {}) }#}
                    {% endif %}
                    
                    {% set adCounter = 0 %}
                    {% set adCount = 0 %}
                    {% set bannerStatus = true %}
                    {% set busUserIndex = 0 %}
                    
                     
                    {% if pagination.getNbResults() %}
                        {% set adFavoriteRepository   = fetch_repository('FaAdBundle:AdFavorite') %}
                        {% set adRepository   = fetch_repository('FaAdBundle:Ad') %}
                        {% if app.user %}
                            {% set userId = app.user.getId() %}
                        {% else %}
                            {% set userId = app.session.getId() %}
                        {% endif %}
                        
                        {% if userLiveBasicAd is defined and userLiveBasicAd and userLiveBasicAd|length %}
                            {% for ad in userLiveBasicAd %}
                                <li>{{ include('FaAdBundle:AdList:listDetail.html.twig', {'isLiveBasicAd': 1, 'isTopAd': 1}) }}</li>
                            {% endfor %}                            
                        {% endif %}
                        
                        {% set adFavoriteAdIds = adFavoriteRepository.getFavoriteAdByUserId(userId, container) %}
        
                        {% if topAdResult is defined and topAdResult|length %}
                            {% for ad in topAdResult %}
                                {% set adCount = adCount + 1 %}
                                <li>{{ include('FaAdBundle:AdList:listDetail.html.twig', {'isTopAd': 1}) }}</li>
                            {% endfor %}
                        {% endif %}
                        
                        {% if mobileDetectManager.isMobile() and not mobileDetectManager.isTablet() %}
                        	 {% if (adCount >= 2) %}
                        	 	{% set bannerStatus = false %}	
        	                	{% set zoneId = constant('Fa\\Bundle\\ContentBundle\\Repository\\BannerZoneRepository::ZONE_SR_MOBILE_ABOVE_RESULTS') %}
        	                	<li>{{ include('FaContentBundle:Banner:show.html.twig', {'zone_id': zoneId}) }}</li>
        	                  {% endif %}
        	             {% endif %} 
                        {% set slotAdCount = 0 %}{% set setExtendedHeading = 0 %}
                        {% set FeaturedAdCount = 0 %}
                        {% set getPagNum = (app.request.get('page'))?(app.request.get('page')):1 %}
                        {% set realAdCnt = (getPagNum-1)*20 %}
                        {% for ad in pagination.getCurrentPageResults() %}
                            {% set adCount = adCount + 1 %}
                            {% set realAdCnt = realAdCnt + 1 %}
                            {% set slotAdCount = slotAdCount + 1 %}
        					{% set displayBusinessExposureBlock = 0 %}
        					{% set displayBusinessExposureSingleBlock = 0 %}
        					{% set FeaturedAdCount = FeaturedAdCount + 1 %}
        					
                            {% if ((realAdCnt > resultCount) and (setExtendedHeading==0)) %}
                                <li><div data-alert="" class="alert-box info radius">
                                   <span class="alert-icon">&nbsp;</span>
                                   We found  {{extendedResultCount}} {{ fa_entity_cache_manager.getEntityNameById('FaEntityBundle:Category', searchParams.item__category_id) }} ads within  {{extendedRadius}} miles of {{ app.request.get('location') | replace({'-':' '}) | title }}
                                </div></li>
                                {% set setExtendedHeading = 1 %}
                            {% endif %}
        
                            {% if displayRecommendedSlot==1 and recommendedSlotsCount > 0 %}
                                {% if slotAdCount== 4  and (recommendedSlotResult[2] is defined and recommendedSlotResult[2]|length >0) %}
                                    {{ include('FaAdBundle:AdList:showRecommendedSlots.html.twig', {'slotIndex': 2 }) }}
                                    {% set slotallocated = slotallocated|merge([2]) %}
                                {% elseif slotAdCount== 7  and (recommendedSlotResult[3] is defined and recommendedSlotResult[3]|length >0) %}
                                    {{ include('FaAdBundle:AdList:showRecommendedSlots.html.twig', {'slotIndex': 3 }) }}
                                    {% set slotallocated = slotallocated|merge([3]) %}
                                {% elseif slotAdCount== 10  and (recommendedSlotResult[4] is defined and recommendedSlotResult[4]|length >0) %}
                                    {{ include('FaAdBundle:AdList:showRecommendedSlots.html.twig', {'slotIndex': 4 }) }}
                                    {% set slotallocated = slotallocated|merge([4]) %}
                                {% elseif slotAdCount== 13  and (recommendedSlotResult[5] is defined and recommendedSlotResult[5]|length >0) %}
                                    {{ include('FaAdBundle:AdList:showRecommendedSlots.html.twig', {'slotIndex': 5 }) }}
                                    {% set slotallocated = slotallocated|merge([5]) %}
                                {% elseif slotAdCount== 16  and (recommendedSlotResult[6] is defined and recommendedSlotResult[6]|length >0) %}
                                    {{ include('FaAdBundle:AdList:showRecommendedSlots.html.twig', {'slotIndex': 6 }) }}
                                    {% set slotallocated = slotallocated|merge([6]) %}
                                {% elseif slotAdCount== 18  and (recommendedSlotResult[7] is defined and recommendedSlotResult[7]|length >0) %}
                                    {{ include('FaAdBundle:AdList:showRecommendedSlots.html.twig', {'slotIndex': 7 }) }}
                                    {% set slotallocated = slotallocated|merge([7]) %}
                                {% elseif slotAdCount== 20  and (recommendedSlotResult[8] is defined and recommendedSlotResult[8]|length >0) %}
                                    {{ include('FaAdBundle:AdList:showRecommendedSlots.html.twig', {'slotIndex': 8 }) }}
                                    {% set slotallocated = slotallocated|merge([8]) %}
                                {% endif %}
                            {% endif %} 
                            
                        {% if businessExposureUsersDetails is defined and businessExposureUsersDetails|length > 0 and totalAdCount > 0  %}                       
                        
                        {% if FeaturedAdCount==5 or FeaturedAdCount==15 %} 
                                {% set displayBusinessExposureBlock = 1 %}
                            {% elseif FeaturedAdCount==10 %} 
                            	{% set displayBusinessExposureSingleBlock = 1 %}
                            {% endif %}
                            {% if displayBusinessExposureBlock ==1 and businessExposureUsersDetails is defined and  businessExposureUsersDetails|length > 0 %} 
                                <li>{{ include('FaAdBundle:AdList:businessExposureSliderBlock.html.twig', {'blockposition': FeaturedAdCount }) }}</li>
                        	{% endif %}
                        	{% if displayBusinessExposureSingleBlock ==1 and businessExposureUsersDetails is defined and  businessExposureUsersDetails|length > 0 %} 
                                <li>{{ include('FaAdBundle:AdList:businessExposureSingleBlock.html.twig') }}</li>
                        	{% endif %}
                        {% endif %}
                            
        
                            <li>{{ include('FaAdBundle:AdList:listDetail.html.twig') }}</li>
                            {% set adCounter = adCounter + 1 %}
        
                            {% if pagination.getNbPages() == pagination.getCurrentPage() %}
                                {% set toPage = pagination.getNbResults() %}
                            {% else %}
                                {% set toPage = pagination.getCurrentPage() * pagination.getMaxPerPage() %}
                            {% endif %}
                            {% set fromPage = 0 %}
                            {% if pagination.getNbResults() %}
                               {% set fromPage = ((pagination.getCurrentPage() - 1) * pagination.getMaxPerPage()) %}
                            {% endif %}
                            {% set totalAdsOnPage = (toPage - fromPage) %}
        
                            {% if mobileDetectManager.isMobile() and not mobileDetectManager.isTablet() %}
                            	 {% if (adCounter == 2 	and totalAdsOnPage > 2 and bannerStatus) %}
        		                	{% set zoneId = constant('Fa\\Bundle\\ContentBundle\\Repository\\BannerZoneRepository::ZONE_SR_MOBILE_ABOVE_RESULTS') %}
        		                	<li>{{ include('FaContentBundle:Banner:show.html.twig', {'zone_id': zoneId}) }}</li>
        		                  {% endif %}
        		             {% endif %}                    
        
                            {% if not mobileDetectManager.isMobile() or mobileDetectManager.isTablet() %}
                                {% if (adCounter == 5 and totalAdsOnPage > 5) or (totalAdsOnPage <= 5 and totalAdsOnPage == adCounter) %}
                                    <li class="mb20">
                                        {{ include('FaAdBundle:AdList:profileExposureBlock.html.twig', {}) }}
                                    </li>
                                {% endif %}
                            {% endif %}
        
                            {% if adCounter == 5 and pagination.getNbResults() > 5 %}
                                {% set zoneId = constant('Fa\\Bundle\\ContentBundle\\Repository\\BannerZoneRepository::ZONE_SR_IN_RESULTS_TOP') %}
                                <li>{{ include('FaContentBundle:Banner:show.html.twig', {'zone_id': zoneId}) }}</li>
                            {% endif %}
        
                            {% if mobileDetectManager.isMobile() and not mobileDetectManager.isTablet() %}
                                {% if (adCounter == 10 and totalAdsOnPage > 10) or (totalAdsOnPage <= 10 and totalAdsOnPage == adCounter) %}
                                    <li class="mb20">
                                        {{ include('FaAdBundle:AdList:profileExposureBlock.html.twig', {}) }}
                                    </li>
                                {% endif %}
                            {% endif %}
        
                            {% if adCounter == 10 and pagination.getNbResults() > 10 %}
                                {% set zoneId = constant('Fa\\Bundle\\ContentBundle\\Repository\\BannerZoneRepository::ZONE_SR_IN_RESULTS_BOTTOM') %}
                                <li>{{ include('FaContentBundle:Banner:show.html.twig', {'zone_id': zoneId}) }}</li>
        
                                {% if mobileDetectManager.isMobile() and not mobileDetectManager.isTablet() %}
                                    {% set zoneId = constant('Fa\\Bundle\\ContentBundle\\Repository\\BannerZoneRepository::ZONE_SR_MOBILE_IN_RESULTS') %}
                                    <li>{{ include('FaContentBundle:Banner:show.html.twig', {'zone_id': zoneId}) }}</li>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
        
                        {% if displayRecommendedSlot==1 and recommendedSlotsCount > 0 %}
                            {% for recommendedSlotSingle in recommendedSlotResult %}
                              {% if recommendedSlotSingle['creative_group'] not in slotallocated %}
                                <li>{{ include('FaAdBundle:AdList:showRecommendedSlots.html.twig', {'slotIndex': recommendedSlotSingle['creative_group'] }) }}</li>
                                {% set slotallocated = slotallocated|merge([recommendedSlotSingle['creative_group']]) %}
                              {% endif %}
                            {% endfor %}
                        {% endif %}
        
                    
                    {% else %}
                        <li><div data-alert class="alert-box info radius mt10">
                            <span class="alert-icon">&nbsp;</span>
                            Sorry, we haven't found adverts matching your criteria in {{ app.request.get('location')| replace({'-':' '}) | title }}: <span style="font-weight:normal">Try modifying your keyword or filters selected.</span>
                        </div></li>
                    {% endif %}
        
                    <li id="createAlertBlockSpan">
                        {{ render(controller('FaAdBundle:AdList:createAlertBlock')) }}
                    </li>
                     </ul>
        			</div>
        
                    <div class="pagination-centered d-flex justify-content-around">
                        {{ include('FaFrontendBundle:Default:googlePager.html.twig', {'pagination': pagination, 'addToEndPage': 1, 'seoPager': true}) }}
                    </div>
                    
                    {% if totalAdCount==0 %}
                        {% if fourLocationsDetails|length > 0 %}
                            <div class="listing">
                            We did mange to find adverts in these other location across the UK
                            <ul class="fourlocationlist">
                            {% for fourLocationsDetail in fourLocationsDetails %}
                                <li><a href="{{fourLocationsDetail['locationUrl']}}">{{fourLocationsDetail['name']}} ({{fourLocationsDetail['cnt']}})</a></li>
                            {% endfor %}
                            </ul>
                            </div>
                        {% endif %}
        
                        {% if getXMiles > 0 %}
                        <div class="listing">
                            Or you can view matching adverts within {{getXMiles}} miles of {{ app.request.get('location') | replace({'-':' '}) | title }}
                            <div class="text-center mt20"><a href="{{ container.get('fa_ad.manager.ad_routing').getListingUrl(searchParams|merge({'item__distance': getXMiles })) }}" class="secondary-btn-1 button mb0"  style="color:#fff">View matching adverts</a></div>
                        </div>
                        {% endif %}
                    {% endif %}
        
                    {% if (adCounter > 3) %}
                        {% set zoneId = constant('Fa\\Bundle\\ContentBundle\\Repository\\BannerZoneRepository::ZONE_SR_BELOW_RESULTS') %}
                        {{ include('FaContentBundle:Banner:show.html.twig', {'zone_id': zoneId}) }}
        
                        {% set zoneId = constant('Fa\\Bundle\\ContentBundle\\Repository\\BannerZoneRepository::ZONE_SR_MOBILE_BELOW_RESULTS') %}
                        {{ include('FaContentBundle:Banner:show.html.twig', {'zone_id': zoneId}) }}
                    {% endif %}
        
                    {% set locationUK = constant('Fa\\Bundle\\EntityBundle\\Repository\\LocationRepository::COUNTY_ID') %}
        
                    {% if (pagination.haveToPaginate()) %}
                        {% set zoneId = constant('Fa\\Bundle\\ContentBundle\\Repository\\BannerZoneRepository::ZONE_SR_BELOW_PAGINATION_DESKTOP') %}
                        {{ include('FaContentBundle:Banner:show.html.twig', {'zone_id': zoneId}) }}
                        
                        {% set zoneId = constant('Fa\\Bundle\\ContentBundle\\Repository\\BannerZoneRepository::ZONE_SR_BELOW_PAGINATION_TABLET') %}
                        {{ include('FaContentBundle:Banner:show.html.twig', {'zone_id': zoneId}) }}
                        
                        {% set zoneId = constant('Fa\\Bundle\\ContentBundle\\Repository\\BannerZoneRepository::ZONE_SR_BELOW_PAGINATION_MOBILE') %}
                        {{ include('FaContentBundle:Banner:show.html.twig', {'zone_id': zoneId}) }}
                    {% endif %}
        
                    {% if searchParams is defined and (searchParams.expired_ads is not defined or (searchParams.expired_ads is defined and searchParams.expired_ads is null)) %}
                        
                            {{ render(controller('FaAdBundle:AdList:showListingSeoBlocks', {'searchParams': searchAgentData, 'customized_url': customized_url, 'location': app.request.get('location'), 'seoPageRule': seoPageRule, 'orgRequest': app.request})) }}
                       
                    {% endif %}
                </div>
            </div>
       </div>
    </div>
</div>
<div id="upgradeBasicAdToFeaturedModal" class="modal custom-modal tiny remove-item-modal upgrade-modal"></div>
{% endblock %}

{% set dimension4 = '' %}
{% if searchParams is defined and searchParams.item__category_id is defined and searchParams.item__category_id is not null %}
{% set categoryPath = fetch_repository('FaEntityBundle:Category').getCategoryPathArrayById(searchParams.item__category_id, false, fetch_container_instance()) %}
{% if categoryPath|length %}
   {% set dimension4 = categoryPath|join(':') %}
{% endif %}
{% endif %}

{% block dimension2 %}
<script language="javascript" type="text/javascript">
//<![CDATA[
   {% if app.user.getId() is not defined or app.user.getId() is null %}
        ga('set', 'dimension9', 'not logged in');
    {% else %}
        ga('set', 'dimension9', 'logged in');
    {% endif %}
    
    ga('send', 'pageview', {'dimension1': defLocationText, 'dimension2':  'Search_Results', 'dimension4': '{{ dimension4 }}' {% if app.request.get('ti_url') %} ,'dimension8': '{{ app.request.get('ti_url') }}' {% endif %} });
    
//]]>
</script>
{% endblock %}

{% block scriptbottom %}
    {{ include('FaAdBundle:AdList:leftSearchJs.html.twig') }}
    {{ include('FaAdBundle:AdList:listJs.html.twig') }}
    {{ include('FaAdBundle:Ad:upgradeJs.html.twig', {'paymentTransactionJs' : paymentTransactionJs }) }}

    {% set catSrchText = null %}
    {% if get_variables('SrchCatDetails') is not null and get_variables('SrchCatDetails').catSrchString is defined %}
        {% set catSrchText = get_variables('SrchCatDetails').catSrchString %}
    {% endif %}


   <script language="javascript" type="text/javascript">
    //<![CDATA[

    $(document).on("click", '.unsaved-item', function(event) {
        ga('send', 'event', 'Top Widget', 'Like');
    });

    $(document).on("click", '.saved-item', function(event) {
        ga('send', 'event', 'Top Widget', 'Unlike');
    });
	
    

    {% if userLiveBasicAd is defined and userLiveBasicAd and userLiveBasicAd|length %}
    	ga('send', 'event', 'Search Results', 'Upgrade', 'View', { nonInteraction: true });
    {% endif %}

    {% if successPaymentModalbox is defined and successPaymentModalbox %}
    	$('#upgradeSuccessPaymentModal').modal('show');
    {% endif %}

    $(window).scroll(function () {
        if ($("#banner_placeholder_2_4").length)
        {
        	var rightBannerOffset = $(".right-banner").offset().top;
            var rightBannerPos = rightBannerOffset - $(window).scrollTop();

            if (rightBannerPos < 0) {
                $("#banner_placeholder_2_4").addClass("fixed-banner");
            } else if (rightBannerPos > 0) {
                $("#banner_placeholder_2_4").removeClass("fixed-banner");
            }

            var footerOffset = $("#footer_tag").offset().top;
            var footerPos = footerOffset - $(window).scrollTop();

            if (parseInt(footerPos) <= 630) {
            	$("#banner_placeholder_2_4").removeClass("fixed-banner");
            }
        }
    });

    function visitUserProfileOrAd(eventCategory, eventAction, eventLabel)
    {
      ga('send', 'event', eventCategory, eventAction, eventLabel);
    }

    function gaSendForRecommendedSlotSearch(url, domain, title,slotindex,creativeOrd) 
    {
        ga('send', 'event', 'Search List Page', 'Recommended external ads', 'Slot'+slotindex + "-Creative"+ creativeOrd +"-{{ catSrchText|trim('-') }}-" + domain + "-" + title);
        window.open(url, '_blank');
    }

    //]]>
    </script>
    
{% endblock %}

{% block pushNotification %}
{% if paymentTransactionJs['ga_transaction'] is defined and paymentTransactionJs['ga_transaction'].PAYMENT_ID is defined %}
        OneSignal.push(["sendTags", {'PAA_process': 'ad_placed'}]);
    {% endif %}
{% endblock %}
