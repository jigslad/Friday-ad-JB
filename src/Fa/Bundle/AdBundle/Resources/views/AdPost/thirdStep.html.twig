{% extends 'FaFrontendBundle::layout.html.twig' %}
{% form_theme form 'FaFrontendBundle:Form:fields.html.twig' %}

{% block page_title %}
    {{'Post an Ad Add your details'|trans({}, 'frontend-paa-login')}}
{% endblock %}

{% set loginError = strip_tags(form_errors(form), '')|trim %}

{% block body %}
    <div class="posting-bg">
        <div class="container">
            <div class="row">
                {{ include('FaAdBundle:AdPost:paaStepsList.html.twig', {'step' : 3}) }}
                <div id="middle-column" class="col-md-12 medium-col step-login">
                    <div>
                        <a href="{{ path('ad_post_second_step', {'is_edit' : 1}) }}" class="paa-back-arrow" title="{{ 'Go back'|trans({}, 'frontend-paa') }}">{{ 'Go back'|trans({}, 'frontend-paa') }}</a>
                    </div>
                    <div class="col-md-24 d-flex justify-content-center">
                        <h1 class="s-h1 paa-title col-md-24 col-lg-18 text-center">
                            {{'Save your ad'|trans({}, 'frontend-paa-login')}}
                        </h1>
                    </div>
                    <div class="col-sm-24 col-md-22 col-lg-16 paa-box" style="margin: 0 auto;">
                        <div class="paa-save-item">
                            {{ form_start(form, {'attr': {'novalidate': '', 'id': 'paa_login_id'}}) }}
                                {{ form_errors(form) }}
                                <div class="col-md-24 d-flex justify-content-center paa-box">
                                    <div class="paa-login-box">
                                        {{ form_row(form.username, {'attr': {'tabindex':'1'}}) }}
                                    </div>
                                </div>
                                <div class="col-md-24 d-flex paa-box paa-usr-type">
                                   {{ form_widget(form.user_type, {'attr': {'onchange':'showUserTypeField()', 'class': 'grey-radio radio-circle-btn'}}) }}
                                   {{ form_errors(form.user_type) }}
                                </div>
                                <div class="" id="new_account">
                                    <div class="col-md-24 d-flex justify-content-center paa-box">
                                        <div class="paa-login-box">
                                            <div id="paa_password_field_div" class="relative paa-forgot-pwd">
                                                {{ form_row(form.password, {'attr': {'tabindex':'2'}}) }}
                                                <a href="#forgotPassword" onclick="javascript:forgotPassword();">{{'Forgot password?'|trans({}, 'frontend-paa-login')}}</a>
                                                <div id="forgotPasswordDiv"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-24 d-flex paa-box">
                                        <div class="grey-check">
                                            {{ form_widget(form.show_password, {'attr': {'class': 'checkbox'}}) }}
                            				<label for="{{ form.show_password.vars.id }}"></label>Show password
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-24 d-flex justify-content-center paa-box">
                                    <div class="paa-login-box">
                                        {{ form_widget(form.save, {'attr': {'class':'primary-btn-1 btn btn-block next-btn'}}) }}
                                    </div>
                                </div>
                                <div class="col-md-24 d-flex justify-content-center paa-box">
                                    <div class="paa-login-box">
                                        <div class="connect-text">{{'Or connect with'|trans({}, 'frontend-paa-login')}}</div>
                                    </div>
                                </div>
                                <div class="col-md-24 d-flex justify-content-center paa-box">
                                    <div class="paa-login-box m-paa-social-box">
                                    <div class="mobile-block-reg">
                                    	<div class="text-center mb20">
                                            <a href="javascript:fbLoginPopupLocal('{{ facebookLoginUrl }}');" class="button special signup-fb-btn">
                                                <span class="fb-icon"></span> 
                                                <span class="btn-text">{{ 'Login with Facebook'|trans({}, 'frontend-paa-login') }}</span>
                                            </a>
                                        </div>
                                        <div class="text-center mb20">
                                            <a href="javascript:googleLoginPopupLocal('{{ googleLoginUrl }}');" class="button special signup-google-btn">
                                                <span class="google-icon"></span> 
                                                <span class="btn-text">{{ 'Login with Google'|trans({}, 'frontend-paa-login') }}</span>
                                            </a>
                                        </div>
                                      </div>                                       
                                    </div>
                                </div>
                                <p class="post-info">{{"We won't post anything <b>without your permission.</b>"|trans({}, 'frontend-paa-login')|raw}}</p>
                            {{ form_end(form) }}
                        </div>
                    </div>
                </div>
                {{ include('FaAdBundle:AdPost:paaPageHelp.html.twig', {'paaBlockSlug': 'paa-login-third-step'}) }}
            </div>
        </div>
    </div>
{% endblock %}

{% block scriptbottom %}
<script language="javascript" type="text/javascript">
//<![CDATA[
    $(document).ready(function(){
      {% if (gaStr is defined and gaStr != '') %}
         {% if (isErrors is defined and isErrors == 1) %}
             ga('send', 'event', 'PAA - Step 3', 'Form error', '{{gaStr}}');
         {% else %}
             ga('send', 'event', 'PAA - Step 2', 'Next step', '{{gaStr}}');
         {% endif %}
      {% elseif (loginError is defined and loginError != '') %}
          ga('send', 'event', 'PAA - Step 3', 'Form error', '{{loginError}}');
      {% endif %}
      
        showUserTypeField();
        // untick show_password
        if ($('#fa_paa_login_show_password').is(':checked')) {
            $('#fa_paa_login_show_password').attr('checked', false);
            $('#fa_paa_login_show_password').closest('span').removeClass('checked');
        }
    });

    function showUserTypeField()
    {
        var userType = "";
        var selected = $("input[type='radio'][name='fa_paa_login[user_type]']:checked");
        if (selected.length > 0) {
            userType = selected.val();
        }
        
        if (userType == 2) {
            $('#fa_paa_login_password').val('');
            $('#paa_password_field_div').hide();
            $('#fa_paa_login_save').text("{{'Sign up with email'|trans({}, 'frontend-paa-login')}}");
        } else {
            $('#paa_password_field_div').show();
            $('#fa_paa_login_save').text("{{'Next step: add more details'|trans({}, 'frontend-paa-login')}}");
        }
    }
    
    $("#fa_paa_login_show_password").click(function() {
        showHidePassword();
    });

    function showHidePassword() {
        if ($('#fa_paa_login_show_password:checked').val()) {
            $('#fa_paa_login_password').attr('type', 'text');
        } else {
            $('#fa_paa_login_password').attr('type', 'password');
        }
    }

    function fbLoginPopupLocal(facebookLoginUrl)
    {
      ga('send', 'event', 'PAA - Step 3', 'Next step', 'facebook');
      fbLoginPopup(facebookLoginUrl);
    }

    function googleLoginPopupLocal(googleLoginUrl)
    {
      ga('send', 'event', 'PAA - Step 3', 'Next step', 'google +');
      googleLoginPopup(googleLoginUrl);
    }

    if ($('[type="email"]').next() && $('[type="email"]').next().hasClass('error')) {
        $('[name="fa_paa_login[user_type]"]').closest('.custom-radio').removeClass('checked');
        $('[name="fa_paa_login[user_type]"]').removeAttr('checked');

        $('#fa_paa_login_user_type_0').trigger('click');
        $('#fa_paa_login_user_type_0').closest('.custom-radio').addClass('checked');
        $('#fa_paa_login_user_type_0').attr('checked', 'checked');
    }

    $(window).load(function() {
        if ($('[type="email"]').next() && $('[type="email"]').next().hasClass('error')) {
            $('[name="fa_paa_login[user_type]"]').closest('.custom-radio').removeClass('checked');
            $('[name="fa_paa_login[user_type]"]').removeAttr('checked');

            $('#fa_paa_login_user_type_0').trigger('click');
            $('#fa_paa_login_user_type_0').closest('.custom-radio').addClass('checked');
            $('#fa_paa_login_user_type_0').attr('checked', 'checked');
        }
    });
//]]>
</script>
{% endblock %}