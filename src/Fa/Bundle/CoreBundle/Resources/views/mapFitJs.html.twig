<script defer type="text/javascript" src="https://leafletjs-cdn.s3.amazonaws.com/content/leaflet/master/leaflet.js"></script>
<script defer type="text/javascript" src="https://tiles.unwiredmaps.com/js/leaflet-unwired.js"></script>
<script language="javascript" type="text/javascript">
//<![CDATA[
var map, streets, myMarker, myIcon;
$(window).on('load', function() {
	apikey = "{{ key }}";
	streets = L.tileLayer.Unwired({key: apikey, scheme: "streets"});
	myIcon = L.icon({className:"", iconUrl: "{{ asset_url('fafrontend/images/map-marker.png') }}"});
});
function showAddress(val) {
    var latitude = '';
    var longitude = '';
    if(map && myMarker) {  
        map.removeLayer(myMarker);
    }
    let settings = {
  		  "async": true,
  		  "crossDomain": true,
  		  "url": 'https://eu1.locationiq.com/v1/search.php?key={{ key|raw }}&q=="'+val+'"&format=json&countrycodes=gb&limit=1',
  		  "method": "GET"
  		}

  		$.ajax(settings).done(function (response) {
  			if(response && response.length > 0) {
  				$.each(response, function (i, address_component) {
  					if(typeof address_component.lat != 'undefined' && typeof address_component.lon != 'undefined') {
  						if(map && myMarker) {  
  					        map.removeLayer(myMarker);
  					    }
				 		latitude = address_component.lat;
  	                    longitude = address_component.lon;							
						map.setView(new L.LatLng(latitude, longitude), 8);
						myMarker = L.marker([latitude, longitude], {icon: myIcon}).addTo(map);
						map.flyTo([address_component.lat, address_component.lon]);
  					}
  				});
  			}
  		});
}

function initialize(lat, lng) { 
	map = L.map('mapfit', {
        center: [lat, lng], // Map loads with this location as center
        zoom: 10,
        scrollWheelZoom: true,
        layers: [streets], // Show 'streets' by default
    });
}

function showMapForPaa(lat, lng, field = '', pointField = '') {
	if(map && myMarker) {  
        map.removeLayer(myMarker);
    }
    
	if(!map) {
		// Initialize the map
	    map = L.map('mapfit', {
	        center: [lat, lng], // Map loads with this location as center
	        zoom: 10,
	        scrollWheelZoom: true,
	        layers: [streets], // Show 'streets' by default
	    });
	}
	myMarker = L.marker([lat, lng], {icon: myIcon}).addTo(map);
}

function showMarker(lat, lng) {
	if(map && myMarker) {  
        map.removeLayer(myMarker);
    }
    
	if(!map) {
		// Initialize the map
	    map = L.map('mapfit', {
	        center: [lat, lng], // Map loads with this location as center
	        zoom: 10,
	        scrollWheelZoom: true,
	        layers: [streets], // Show 'streets' by default
	    });
	}
	myMarker = L.marker([lat, lng], {icon: myIcon}).addTo(map);
}

function showCustomMarker(lat, lng, markerImage)
{
	if(map && myMarker) {  
        map.removeLayer(myMarker);
    }
    
	if(!map) {
		// Initialize the map
	    map = L.map('mapfit', {
	        center: [lat, lng], // Map loads with this location as center
	        zoom: 10,
	        scrollWheelZoom: true,
	        layers: [streets], // Show 'streets' by default
	    });
	}
	myMarker = L.marker([lat, lng], {icon: myIcon}).addTo(map);
}

//]]>
</script>