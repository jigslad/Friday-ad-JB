<script>
    $(document).on('click', '.datatable-action-list .fa.redirectdelete', function () {
        redirectdeleteRow($(this).parents('tr').first())
    });
    $(document).on('click', '.datatable-action-list .fa.redirectsave', function () {
        redirectsaveRow($(this).parents('tr').first())
    });
    $('#redirects').DataTable( {
        ajax: '{{ path('admin_seo_config_redirects_datatable', {'config': 'redirects'}) }}',
        columns: [
            { data: 'from' },
            { data: 'to' },
            { data: 'type' },
            { data: 'action' },
        ],
        "deferRender": true,
        // "processing": true,
        // "serverSide": true,
        dom: 'Bfrtip',
        buttons: [
            'excelHtml5',
            'csvHtml5',
            'pdfHtml5',
            'pageLength',
        ]
    } );
    function editRow(row) {
        $.each($(row).find('td'), function (key, td) {

            var settings = $(td).find('span.datatable-action-list');
            if (settings.length) {
                $(settings).find('.save').removeClass('hidden');
                $(settings).find('.redirectsave').removeClass('hidden');
                $(settings).find('.undo').removeClass('hidden');
                $(settings).find('.edit').addClass('hidden');
            } else {
                var text = $(td).text();
                var html = $(td).html();

                var textarea = $('<input>').css({width: '95%'}).attr('data-value', text).val(text);
                $(td).html(textarea)
            }

        });
    }
    function redirectsaveRow(row) {
        var ruleFrom = $(row).find('.datatable-action-list .data').first().html();
        var table = $(row).parents('table').first();
        var config = $(table).data('rule');

        var ruleTo = [];
        $.each($(row).find('input:not(.hidden)'), function (key, input) {
            ruleTo.push($(input).val());
        });

        ruleTo = ruleTo.join(':');

        console.log(ruleFrom, ruleTo);
        blockPage('Saving rule');

        $.ajax({
            type: "POST",
            url: "{{path('admin_seo_config_datatable_redirectedit')}}",
            data: {
                config: config,
                rule_from: ruleFrom,
                rule_to: ruleTo
            }
        })
            .done(function(response) {
                unblockPage();

                if (response.changed) {
                    $(table).DataTable().ajax.reload()
                } else {
                    alert('Rule not Saved')
                }

            });

    }
    function update_redirects() {

        var select = $('#Redirects');
        blockPage();

        $.ajax({
            type: "POST",
            url: "{{path('seo_config_redirects')}}",
            data: {
                "data": getData($(select).select2('data'))
            }
        })
            .done(function() {
                unblockPage();
                $(select).parent().find('.select2-container').removeClass('unsaved').addClass('saved')
            });
    }
</script>